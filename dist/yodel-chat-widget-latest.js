(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},r=[],a=0;a<e.length;a++){var l=e[a],c=o.base?l[0]+o.base:l[0],d=i[c]||0,h="".concat(c," ").concat(d);i[c]=d+1;var p=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var g=s(u,o);o.byIndex=a,t.splice(a,0,{identifier:h,updater:g,references:1})}r.push(h)}return r}function s(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var i=o(e=e||[],s=s||{});return function(e){e=e||[];for(var r=0;r<i.length;r++){var a=n(i[r]);t[a].references--}for(var l=o(e,s),c=0;c<i.length;c++){var d=n(i[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,s,i){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&r[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},352:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(601),s=n.n(o),i=n(314),r=n.n(i)()(s());r.push([e.id,"/**\n * Yodel Chat Widget Styles\n * Isolated styles for the chat widget\n * With Markdown support\n */\n\n/* Base container */\n.yodel-chat-widget {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  z-index: 9999;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  color: #333;\n}\n\n/* Chat button */\n.yodel-chat-button {\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  /* Background color now set via JavaScript to match widget_button_color */\n  border: none;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n  outline: none;\n  position: relative;\n  z-index: 1;\n}\n\n.yodel-chat-button:hover {\n  transform: scale(1.05);\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);\n  /* Darken whatever color was applied via JS */\n  filter: brightness(0.9);\n}\n\n.yodel-chat-button:active {\n  transform: scale(0.95);\n}\n\n.yodel-chat-button img {\n  width: 30px;\n  height: 30px;\n  object-fit: cover;\n  border-radius: 50%;\n}\n\n/* Chat window */\n.yodel-chat-window {\n  position: absolute;\n  bottom: 80px;\n  right: 0;\n  width: 350px;\n  height: calc(100vh - 100px);\n  max-height: 600px;\n  background-color: #fff;\n  border-radius: 10px;\n  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  transition: opacity 0.3s ease, transform 0.3s ease;\n  transform-origin: bottom right;\n}\n\n/* Chat header */\n.yodel-chat-header {\n  padding: 15px;\n  background-color: #4a86e8;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n}\n\n.yodel-chat-title {\n  font-weight: 600;\n  font-size: 16px;\n}\n\n/* Reset button */\n.yodel-chat-reset {\n  background: none;\n  border: none;\n  color: #fff;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  margin: 0 10px 0 auto;\n  line-height: 1;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0.8;\n  transition: opacity 0.2s ease;\n}\n\n.yodel-chat-reset:hover {\n  opacity: 1;\n  transform: rotate(30deg);\n  transition: opacity 0.2s ease, transform 0.3s ease;\n}\n\n.yodel-chat-reset svg {\n  width: 20px;\n  height: 20px;\n}\n\n/* Close button */\n.yodel-chat-close {\n  background: none;\n  border: none;\n  color: #fff;\n  font-size: 24px;\n  cursor: pointer;\n  padding: 0;\n  margin: 0;\n  line-height: 1;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0.8;\n  transition: opacity 0.2s ease, transform 0.2s ease;\n}\n\n.yodel-chat-close:hover {\n  opacity: 1;\n  transform: scale(1.1);\n}\n\n.yodel-chat-close svg {\n  width: 20px;\n  height: 20px;\n}\n\n/* Messages container */\n.yodel-chat-messages {\n  flex: 1;\n  padding: 15px;\n  overflow-y: auto;\n  background-color: #f7f7f7;\n  scroll-behavior: smooth;\n}\n\n/* Individual message */\n.yodel-message {\n  margin-bottom: 15px;\n  display: flex;\n  align-items: flex-start;\n}\n\n.yodel-message-user {\n  justify-content: flex-end;\n}\n\n.yodel-message-assistant {\n  justify-content: flex-start;\n}\n\n/* Avatar */\n.yodel-avatar {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  background-color: #e0e0e0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n  color: #666;\n  margin-right: 8px;\n  flex-shrink: 0;\n}\n\n.yodel-message-user .yodel-avatar {\n  margin-right: 0;\n  margin-left: 8px;\n  order: 2;\n  background-color: #4a86e8;\n  color: #fff;\n}\n\n.yodel-avatar img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  object-fit: cover;\n}\n\n/* Content container */\n.yodel-content-container {\n  display: flex;\n  flex-direction: column;\n  max-width: 80%;\n  margin-left: 8px;\n}\n\n/* Message bubble */\n.yodel-bubble {\n  padding: 10px 14px;\n  overflow-wrap: break-word;\n  border-radius: 16px;\n  word-wrap: break-word;\n  line-height: 1.4;\n  max-width: 100%;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n}\n\n/* Markdown styles inside bubbles */\n.yodel-bubble h1,\n.yodel-bubble h2,\n.yodel-bubble h3,\n.yodel-bubble h4,\n.yodel-bubble h5,\n.yodel-bubble h6 {\n  margin-top: 8px;\n  margin-bottom: 8px;\n  font-weight: 600;\n  line-height: 1.25;\n}\n\n.yodel-bubble h1 {\n  font-size: 18px;\n}\n\n.yodel-bubble h2 {\n  font-size: 16px;\n}\n\n.yodel-bubble h3,\n.yodel-bubble h4,\n.yodel-bubble h5,\n.yodel-bubble h6 {\n  font-size: 14px;\n}\n\n.yodel-bubble p {\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n\n.yodel-bubble ul,\n.yodel-bubble ol {\n  padding-left: 20px;\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n\n.yodel-bubble li {\n  margin-bottom: 2px;\n}\n\n.yodel-bubble code {\n  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;\n  padding: 2px 4px;\n  font-size: 90%;\n  color: #333;\n  background-color: rgba(0, 0, 0, 0.05);\n  border-radius: 3px;\n}\n\n.yodel-bubble pre {\n  margin-top: 8px;\n  margin-bottom: 8px;\n  padding: 10px;\n  background-color: rgba(0, 0, 0, 0.05);\n  border-radius: 5px;\n  overflow-x: auto;\n}\n\n.yodel-bubble pre code {\n  padding: 0;\n  background-color: transparent;\n  border-radius: 0;\n  display: block;\n}\n\n.yodel-bubble blockquote {\n  padding-left: 10px;\n  margin-left: 5px;\n  border-left: 3px solid rgba(0, 0, 0, 0.1);\n  color: #555;\n}\n\n.yodel-bubble a {\n  color: #0366d6;\n  text-decoration: none;\n}\n\n.yodel-bubble a:hover {\n  text-decoration: underline;\n}\n\n.yodel-bubble img {\n  max-width: 100%;\n  max-height: 300px;\n  border-radius: 5px;\n  margin-top: 4px;\n  margin-bottom: 4px;\n}\n\n.yodel-bubble table {\n  border-collapse: collapse;\n  width: 100%;\n  margin-top: 8px;\n  margin-bottom: 8px;\n}\n\n.yodel-bubble table th,\n.yodel-bubble table td {\n  padding: 6px 8px;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  text-align: left;\n}\n\n.yodel-bubble table th {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n/* Adjust specific styling for dark assistant bubbles */\n.yodel-message-user .yodel-bubble a {\n  color: #9ecbff;\n}\n\n.yodel-message-user .yodel-bubble blockquote {\n  border-left-color: rgba(255, 255, 255, 0.3);\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.yodel-message-user .yodel-bubble code {\n  color: #e6e6e6;\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n.yodel-message-user .yodel-bubble pre {\n  background-color: rgba(255, 255, 255, 0.1);\n}\n\n.yodel-message-assistant .yodel-bubble {\n  border-top-left-radius: 2px;\n  background-color: #f0f0f0;\n  border: 1px solid #e5e7eb;\n}\n\n.yodel-message-user .yodel-bubble {\n  border-top-right-radius: 2px;\n  background-color: #4a86e8;\n  color: #fff;\n}\n\n/* Error message */\n.yodel-error-message {\n  background-color: #ffecec !important;\n  color: #e53935 !important;\n  border: 1px solid #ffcdd2;\n}\n\n/* Confirmation dialog */\n.yodel-confirm-dialog {\n  position: absolute;\n  top: 70px; /* Position below the header */\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n  padding: 20px;\n  width: 80%;\n  max-width: 320px;\n  z-index: 10000;\n  text-align: center;\n  color: #333;\n  border: 1px solid #ddd;\n  margin-top: 5px;\n}\n\n.yodel-confirm-message {\n  margin-bottom: 20px;\n  font-size: 15px;\n  color: #000;\n  font-weight: 500;\n  line-height: 1.4;\n}\n\n.yodel-confirm-buttons {\n  display: flex;\n  justify-content: center;\n  gap: 10px;\n}\n\n.yodel-confirm-yes,\n.yodel-confirm-cancel {\n  padding: 8px 16px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n  border: none;\n  transition: background-color 0.2s ease;\n}\n\n.yodel-confirm-yes {\n  background-color: #f44336;\n  color: white;\n}\n\n.yodel-confirm-yes:hover {\n  background-color: #e53935;\n}\n\n.yodel-confirm-cancel {\n  background-color: #e0e0e0;\n  color: #333;\n}\n\n.yodel-confirm-cancel:hover {\n  background-color: #d5d5d5;\n}\n\n/* Placeholder message */\n.yodel-message-placeholder {\n  text-align: center;\n  color: #9e9e9e;\n  font-style: italic;\n  padding: 20px;\n  font-size: 14px;\n}\n\n/* Streaming cursor */\n.yodel-streaming-cursor {\n  display: inline-block;\n  width: 6px;\n  height: 14px;\n  background-color: var(--assistant-font-color, #333);\n  margin-left: 2px;\n  vertical-align: middle;\n  animation: cursor-blink 1s infinite;\n}\n\n@keyframes cursor-blink {\n  0% { opacity: 1; }\n  50% { opacity: 0; }\n  100% { opacity: 1; }\n}\n\n/* Agent status message */\n.yodel-agent-status {\n  display: block;\n  margin-top: 5px;\n  font-size: 12px;\n  color: var(--assistant-font-color, #777);\n  font-style: italic;\n  opacity: 0.8;\n}\n\n/* Message actions section */\n.yodel-message-actions {\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n  padding: 4px 0;\n  margin-top: 4px;\n  font-size: 14px;\n  width: 90%;\n  align-self: flex-start;\n}\n\n.yodel-message-action-button {\n  background: none;\n  border: none;\n  cursor: pointer;\n  margin-left: 8px;\n  padding: 4px 8px;\n  border-radius: 4px;\n  color: #666;\n  display: flex;\n  align-items: center;\n  transition: background-color 0.2s, color 0.2s;\n}\n\n.yodel-message-action-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n  color: #333;\n}\n\n.yodel-message-action-button svg {\n  width: 16px;\n  height: 16px;\n}\n\n.yodel-message-action-button + .yodel-message-action-button {\n  margin-left: 12px;\n}\n\n/* Feedback buttons styles */\n.yodel-thumbs-button.selected {\n  background-color: rgba(0, 0, 0, 0.08);\n}\n\n.yodel-thumbs-up.selected svg {\n  stroke: #28a745;\n  fill: rgba(40, 167, 69, 0.2);\n}\n\n.yodel-thumbs-down.selected svg {\n  stroke: #dc3545;\n  fill: rgba(220, 53, 69, 0.2);\n}\n\n/* Feedback dialog styles */\n.yodel-feedback-dialog {\n  display: none;\n  position: absolute;\n  bottom: 100%;\n  left: 0;\n  width: 100%;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n  padding: 12px;\n  margin-bottom: 8px;\n  z-index: 10;\n  box-sizing: border-box;\n}\n\n.yodel-feedback-dialog.show {\n  display: block;\n}\n\n.yodel-feedback-dialog-title {\n  font-weight: bold;\n  margin-bottom: 8px;\n}\n\n.yodel-feedback-textarea {\n  width: 100%;\n  min-height: 80px;\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  margin-bottom: 8px;\n  resize: vertical;\n  box-sizing: border-box;\n}\n\n.yodel-feedback-buttons {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.yodel-feedback-cancel {\n  background: none;\n  border: none;\n  padding: 6px 12px;\n  margin-right: 8px;\n  cursor: pointer;\n  border-radius: 4px;\n}\n\n.yodel-feedback-submit {\n  background-color: #4a86e8;\n  color: white;\n  border: none;\n  padding: 6px 12px;\n  cursor: pointer;\n  border-radius: 4px;\n}\n\n.yodel-feedback-cancel:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.yodel-feedback-submit:hover {\n  background-color: #3a76d8;\n}\n\n/* Toast notification */\n.yodel-toast {\n  position: fixed;\n  bottom: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: #333;\n  color: white;\n  padding: 10px 20px;\n  border-radius: 4px;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n  z-index: 1000;\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n\n.yodel-toast.show {\n  opacity: 1;\n}\n\n.yodel-copy-success {\n  color: #28a745;\n  font-size: 12px;\n  margin-left: 8px;\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n\n.yodel-copy-success.show {\n  opacity: 1;\n}\n\n/* Loading dots animation */\n.yodel-loading-dots {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 20px;\n}\n\n.yodel-loading-dots div {\n  width: 8px;\n  height: 8px;\n  margin: 0 2px;\n  background-color: #aaa;\n  border-radius: 50%;\n  animation: yodel-loading-dot 1.4s infinite ease-in-out both;\n}\n\n.yodel-loading-dots div:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.yodel-loading-dots div:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes yodel-loading-dot {\n  0%, 80%, 100% {\n    transform: scale(0);\n  }\n  40% {\n    transform: scale(1);\n  }\n}\n\n/* Input area */\n.yodel-chat-input-area {\n  padding: 12px 16px;\n  background-color: #fff;\n  border-top: 1px solid #e0e0e0;\n  display: flex;\n  align-items: center;\n}\n\n/* Input wrapper - pill-shaped container */\n.yodel-input-wrapper {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  background-color: #ffffff;\n  border: 1px solid #d1d5db;\n  border-radius: 24px;\n  padding: 6px 6px 6px 16px;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n\n.yodel-input-wrapper:focus-within {\n  border-color: var(--widget-button-color, #4a86e8);\n  box-shadow: 0 0 0 3px rgba(74, 134, 232, 0.1);\n}\n\n.yodel-chat-input {\n  flex: 1;\n  border: none;\n  background: transparent;\n  padding: 8px 0;\n  resize: none;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  outline: none;\n  max-height: 150px;\n  min-height: 24px;\n}\n\n.yodel-chat-send {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-left: 8px;\n  /* Background color now set via JavaScript to match widget_button_color */\n  color: #fff;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  flex-shrink: 0;\n  transition: opacity 0.2s, filter 0.2s;\n  opacity: 1;\n}\n\n.yodel-chat-send:hover:not(:disabled) {\n  /* Darken whatever color was applied via JS */\n  filter: brightness(0.9);\n}\n\n.yodel-chat-send:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n/* Responsive styles */\n@media (max-width: 639px) {\n  /* Full-screen chat window on mobile */\n  .yodel-chat-window {\n    position: fixed !important;\n    top: 0 !important;\n    left: 0 !important;\n    right: 0 !important;\n    bottom: 0 !important;\n    width: 100vw !important;\n    height: 100vh !important;\n    max-height: none !important;\n    max-width: none !important;\n    border-radius: 0 !important;\n    z-index: 10000 !important;\n    margin: 0 !important;\n    padding: 0 !important;\n  }\n  \n  /* Hide chat button when window is open on mobile */\n  .yodel-chat-widget.yodel-chat-open .yodel-chat-button {\n    display: none !important;\n  }\n  \n  /* Chat button styling on mobile when closed\n  .yodel-chat-button {\n    width: 56px;\n    height: 56px;\n    right: 16px;\n    bottom: 16px;\n  } */\n  \n  /* Header stays at top - no sticky needed, part of flex layout */\n  .yodel-chat-header {\n    border-radius: 0;\n    flex-shrink: 0;\n  }\n  \n  /* Privacy banner if present */\n  .yodel-privacy-banner {\n    flex-shrink: 0;\n  }\n  \n  /* Messages container fills available space */\n  .yodel-chat-messages {\n    flex: 1 1 auto;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    min-height: 0;\n  }\n  \n  /* Input area stays at bottom - part of flex layout */\n  .yodel-chat-input-area {\n    flex-shrink: 0;\n    background-color: #fff;\n    padding: 10px 12px;\n  }\n  \n  /* Adjust input wrapper padding on mobile */\n  .yodel-input-wrapper {\n    padding: 4px 4px 4px 12px;\n  }\n  \n  /* Adjust bubble max-width for better mobile readability */\n  .yodel-bubble {\n    max-width: 85%;\n  }\n  \n  /* Adjust content container max-width */\n  .yodel-content-container {\n    max-width: 85%;\n  }\n  \n  /* Ensure confirmation dialog is visible on mobile */\n  .yodel-confirm-dialog {\n    max-width: 90%;\n    width: 90%;\n  }\n}\n\n/* Privacy Policy Banner */\n.yodel-privacy-banner {\n  padding: 8px 12px;\n  margin: 0;\n  background-color: rgba(0, 0, 0, 0.1);\n  font-size: 12px;\n  line-height: 1.4;\n  color: #656262;\n  text-align: center;\n  width: 100%;\n  box-sizing: border-box;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.yodel-privacy-link {\n  color: #656262;\n  text-decoration: underline;\n  cursor: pointer;\n  font-weight: 500;\n  white-space: nowrap;\n}\n\n.yodel-privacy-link:hover {\n  text-decoration: none;\n}\n\n.yodel-privacy-link:focus {\n  outline: 2px solid #fff;\n  outline-offset: 2px;\n  border-radius: 2px;\n}\n\n/* Privacy Policy Popup */\n.yodel-privacy-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 10000;\n}\n\n.yodel-privacy-popup {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: #fff;\n  border-radius: 10px;\n  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);\n  width: 90%;\n  max-width: 600px;\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  z-index: 10001; /* Higher than overlay */\n  overflow: hidden;\n  color: #333;\n}\n\n.yodel-privacy-header {\n  padding: 16px 20px;\n  border-bottom: 1px solid #e0e0e0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-shrink: 0;\n  background-color: #f8f8f8;\n}\n\n.yodel-privacy-title {\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0;\n  color: #333;\n}\n\n.yodel-privacy-close {\n  background: none;\n  border: none;\n  color: #333;\n  font-size: 24px;\n  cursor: pointer;\n  padding: 0;\n  margin: 0;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0.8;\n  transition: opacity 0.2s ease;\n}\n\n.yodel-privacy-close:hover {\n  opacity: 1;\n}\n\n.yodel-privacy-content {\n  padding: 20px;\n  overflow-y: auto;\n  line-height: 1.6;\n  font-size: 14px;\n  flex: 1;\n}\n\n.yodel-privacy-iframe {\n  width: 100%;\n  height: 100%;\n  min-height: 300px;\n  border: none;\n  display: block;\n}\n\n.yodel-privacy-loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100px;\n}\n\n.yodel-privacy-error {\n  color: #e53935;\n  padding: 16px;\n  text-align: center;\n  border: 1px solid #ffcdd2;\n  border-radius: 6px;\n  background-color: #ffebee;\n}\n\n/* Responsive styles for privacy popup */\n@media (max-width: 480px) {\n  .yodel-privacy-popup {\n    width: 95%;\n    max-height: 90vh;\n  }\n  \n  .yodel-privacy-header {\n    padding: 12px 16px;\n  }\n  \n  .yodel-privacy-content {\n    padding: 16px;\n  }\n}\n\n/* Visually hidden elements (for screen readers) */\n.visually-hidden {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  margin: -1px;\n  padding: 0;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  border: 0;\n}\n\n/* ===== Fin-Style Enhancements ===== */\n\n/* Header Redesign */\n.yodel-header-left {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  flex: 1;\n  min-width: 0;\n}\n\n.yodel-header-right {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.yodel-header-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  overflow: hidden;\n  flex-shrink: 0;\n}\n\n.yodel-header-avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.yodel-header-title-container {\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n  flex: 1;\n}\n\n.yodel-chat-subtitle {\n  font-size: 11px;\n  opacity: 0.9;\n  font-weight: 400;\n  margin-top: 2px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.yodel-chat-expand {\n  background: none;\n  border: none;\n  color: #fff;\n  cursor: pointer;\n  padding: 0;\n  margin: 0;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0.8;\n  transition: opacity 0.2s ease, transform 0.2s ease;\n}\n\n.yodel-chat-expand:hover {\n  opacity: 1;\n  transform: scale(1.1);\n}\n\n/* Expanded Mode */\n.yodel-chat-window.yodel-expanded {\n  position: fixed;\n  max-height: calc(100vh - 40px);\n  height: calc(100vh - 40px);\n  top: 20px;\n  right: 20px;\n  bottom: 20px;\n}\n\n/* Hide chat button when in expanded mode */\n.yodel-widget-expanded .yodel-chat-button {\n  display: none;\n}\n\n/* Notification Badge */\n.yodel-notification-badge {\n  position: absolute;\n  top: -4px;\n  right: -4px;\n  background-color: #ff4444;\n  color: white;\n  border-radius: 10px;\n  min-width: 18px;\n  height: 18px;\n  display: none;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  font-weight: 600;\n  padding: 0 5px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  z-index: 2;\n}\n\n/* Greeting Overlays */\n.yodel-greeting-bubble,\n.yodel-cta-bubble {\n  position: absolute;\n  bottom: 80px;\n  right: 0;\n  background-color: #fff;\n  border-radius: 20px;\n  padding: 12px 16px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  cursor: pointer;\n  transition: all 0.3s ease;\n  animation: yodel-slide-up 0.4s ease;\n  width: 280px;\n  font-size: 14px;\n  color: #333;\n  z-index: 9998;\n}\n\n.yodel-greeting-bubble {\n  bottom: 130px;\n}\n\n.yodel-cta-bubble {\n  bottom: 80px;\n  background-color: var(--widget-button-color, #4a86e8);\n  color: white;\n  font-weight: 500;\n}\n\n.yodel-greeting-bubble:hover,\n.yodel-cta-bubble:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n}\n\n.yodel-fade-out {\n  opacity: 0;\n  transform: translateY(10px);\n}\n\n@keyframes yodel-slide-up {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* Messages Wrapper */\n.yodel-messages-wrapper {\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n/* Scroll-to-Bottom Button */\n.yodel-scroll-to-bottom {\n  position: absolute;\n  bottom: 16px;\n  right: 16px;\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  background-color: var(--widget-button-color, #4a86e8);\n  color: white;\n  border: none;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n  cursor: pointer;\n  display: none;\n  align-items: center;\n  justify-content: center;\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  z-index: 10;\n}\n\n.yodel-scroll-to-bottom:hover {\n  transform: scale(1.1);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n/* Timestamps */\n.yodel-message-timestamp {\n  font-size: 11px;\n  color: #999;\n  margin-top: 4px;\n  display: block;\n}\n\n/* Mobile Adjustments */\n@media (max-width: 639px) {\n  .yodel-chat-window.yodel-expanded {\n    max-height: 100vh;\n    height: 100vh;\n  }\n  \n  /* Hide expand button on mobile - chat is always full screen */\n  .yodel-chat-expand {\n    display: none;\n  }\n  \n  .yodel-greeting-bubble,\n  .yodel-cta-bubble {\n    right: 16px;\n    max-width: calc(100vw - 100px);\n  }\n  \n  .yodel-greeting-bubble {\n    bottom: 140px;\n  }\n  \n  .yodel-cta-bubble {\n    bottom: 90px;\n  }\n}\n",""]);const a=r},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,s&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={id:o,exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o=n(72),s=n.n(o),i=n(825),r=n.n(i),a=n(659),l=n.n(a),c=n(56),d=n.n(c),h=n(540),p=n.n(h),u=n(113),g=n.n(u),f=n(352),b={};b.styleTagTransform=g(),b.setAttributes=d(),b.insert=l().bind(null,"head"),b.domAPI=r(),b.insertStyleElement=p();s()(f.A,b);f.A&&f.A.locals&&f.A.locals;function m(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var y={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function x(e){y=e}var w={exec:()=>null};function k(e,t=""){let n="string"==typeof e?e:e.source;const o={replace:(e,t)=>{let s="string"==typeof t?t:t.source;return s=s.replace(v.caret,"$1"),n=n.replace(e,s),o},getRegex:()=>new RegExp(n,t)};return o}var v={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},_=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,C=/(?:[*+-]|\d{1,9}[.)])/,T=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,B=k(T).replace(/bull/g,C).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),S=k(T).replace(/bull/g,C).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),E=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,$=/(?!\s*\])(?:\\.|[^\[\]\\])+/,z=k(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",$).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),A=k(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,C).getRegex(),I="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",M=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,R=k("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",M).replace("tag",I).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),L=k(E).replace("hr",_).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex(),P={blockquote:k(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",L).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:z,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:_,html:R,lheading:B,list:A,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:L,table:w,text:/^[^\n]+/},H=k("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",_).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex(),N={...P,lheading:S,table:H,paragraph:k(E).replace("hr",_).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",H).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex()},q={...P,html:k("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",M).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:w,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:k(E).replace("hr",_).replace("heading"," *#{1,6} *[^\n]").replace("lheading",B).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},O=/^( {2,}|\\)\n(?!\s*$)/,j=/[\p{P}\p{S}]/u,D=/[\s\p{P}\p{S}]/u,U=/[^\s\p{P}\p{S}]/u,W=k(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,D).getRegex(),Z=/(?!~)[\p{P}\p{S}]/u,F=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,V=k(F,"u").replace(/punct/g,j).getRegex(),G=k(F,"u").replace(/punct/g,Z).getRegex(),J="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Q=k(J,"gu").replace(/notPunctSpace/g,U).replace(/punctSpace/g,D).replace(/punct/g,j).getRegex(),Y=k(J,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,Z).getRegex(),X=k("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,U).replace(/punctSpace/g,D).replace(/punct/g,j).getRegex(),K=k(/\\(punct)/,"gu").replace(/punct/g,j).getRegex(),ee=k(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),te=k(M).replace("(?:--\x3e|$)","--\x3e").getRegex(),ne=k("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",te).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),oe=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,se=k(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",oe).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ie=k(/^!?\[(label)\]\[(ref)\]/).replace("label",oe).replace("ref",$).getRegex(),re=k(/^!?\[(ref)\](?:\[\])?/).replace("ref",$).getRegex(),ae={_backpedal:w,anyPunctuation:K,autolink:ee,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:O,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:w,emStrongLDelim:V,emStrongRDelimAst:Q,emStrongRDelimUnd:X,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:se,nolink:re,punctuation:W,reflink:ie,reflinkSearch:k("reflink|nolink(?!\\()","g").replace("reflink",ie).replace("nolink",re).getRegex(),tag:ne,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:w},le={...ae,link:k(/^!?\[(label)\]\((.*?)\)/).replace("label",oe).getRegex(),reflink:k(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",oe).getRegex()},ce={...ae,emStrongRDelimAst:Y,emStrongLDelim:G,url:k(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},de={...ce,br:k(O).replace("{2,}","*").getRegex(),text:k(ce.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},he={normal:P,gfm:N,pedantic:q},pe={normal:ae,gfm:ce,breaks:de,pedantic:le},ue={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ge=e=>ue[e];function fe(e,t){if(t){if(v.escapeTest.test(e))return e.replace(v.escapeReplace,ge)}else if(v.escapeTestNoEncode.test(e))return e.replace(v.escapeReplaceNoEncode,ge);return e}function be(e){try{e=encodeURI(e).replace(v.percentDecode,"%")}catch{return null}return e}function me(e,t){const n=e.replace(v.findPipe,((e,t,n)=>{let o=!1,s=t;for(;--s>=0&&"\\"===n[s];)o=!o;return o?"|":" |"})).split(v.splitPipe);let o=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;o<n.length;o++)n[o]=n[o].trim().replace(v.slashPipe,"|");return n}function ye(e,t,n){const o=e.length;if(0===o)return"";let s=0;for(;s<o;){const i=e.charAt(o-s-1);if(i!==t||n){if(i===t||!n)break;s++}else s++}return e.slice(0,o-s)}function xe(e,t,n,o,s){const i=t.href,r=t.title||null,a=e[1].replace(s.other.outputLinkReplace,"$1");o.state.inLink=!0;const l={type:"!"===e[0].charAt(0)?"image":"link",raw:n,href:i,title:r,text:a,tokens:o.inlineTokens(a)};return o.state.inLink=!1,l}var we=class{options;rules;lexer;constructor(e){this.options=e||y}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:ye(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t,n){const o=e.match(n.other.indentCodeCompensation);if(null===o)return t;const s=o[1];return t.split("\n").map((e=>{const t=e.match(n.other.beginningSpace);if(null===t)return e;const[o]=t;return o.length>=s.length?e.slice(s.length):e})).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){const t=ye(e,"#");this.options.pedantic?e=t.trim():t&&!this.rules.other.endingSpaceChar.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:ye(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=ye(t[0],"\n").split("\n"),n="",o="";const s=[];for(;e.length>0;){let t=!1;const i=[];let r;for(r=0;r<e.length;r++)if(this.rules.other.blockquoteStart.test(e[r]))i.push(e[r]),t=!0;else{if(t)break;i.push(e[r])}e=e.slice(r);const a=i.join("\n"),l=a.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}\n${a}`:a,o=o?`${o}\n${l}`:l;const c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,s,!0),this.lexer.state.top=c,0===e.length)break;const d=s.at(-1);if("code"===d?.type)break;if("blockquote"===d?.type){const t=d,i=t.raw+"\n"+e.join("\n"),r=this.blockquote(i);s[s.length-1]=r,n=n.substring(0,n.length-t.raw.length)+r.raw,o=o.substring(0,o.length-t.text.length)+r.text;break}if("list"!==d?.type);else{const t=d,i=t.raw+"\n"+e.join("\n"),r=this.list(i);s[s.length-1]=r,n=n.substring(0,n.length-d.raw.length)+r.raw,o=o.substring(0,o.length-t.raw.length)+r.raw,e=i.substring(s.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:n,tokens:s,text:o}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const o=n.length>1,s={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");const i=this.rules.other.listItemRegex(n);let r=!1;for(;e;){let n=!1,o="",a="";if(!(t=i.exec(e)))break;if(this.rules.block.hr.test(e))break;o=t[0],e=e.substring(o.length);let l=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],d=!l.trim(),h=0;if(this.options.pedantic?(h=2,a=l.trimStart()):d?h=t[1].length+1:(h=t[2].search(this.rules.other.nonSpaceChar),h=h>4?1:h,a=l.slice(h),h+=t[1].length),d&&this.rules.other.blankLine.test(c)&&(o+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=this.rules.other.nextBulletRegex(h),n=this.rules.other.hrRegex(h),s=this.rules.other.fencesBeginRegex(h),i=this.rules.other.headingBeginRegex(h),r=this.rules.other.htmlBeginRegex(h);for(;e;){const p=e.split("\n",1)[0];let u;if(c=p,this.options.pedantic?(c=c.replace(this.rules.other.listReplaceNesting,"  "),u=c):u=c.replace(this.rules.other.tabCharGlobal,"    "),s.test(c))break;if(i.test(c))break;if(r.test(c))break;if(t.test(c))break;if(n.test(c))break;if(u.search(this.rules.other.nonSpaceChar)>=h||!c.trim())a+="\n"+u.slice(h);else{if(d)break;if(l.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(s.test(l))break;if(i.test(l))break;if(n.test(l))break;a+="\n"+c}d||c.trim()||(d=!0),o+=p+"\n",e=e.substring(p.length+1),l=u.slice(h)}}s.loose||(r?s.loose=!0:this.rules.other.doubleBlankLine.test(o)&&(r=!0));let p,u=null;this.options.gfm&&(u=this.rules.other.listIsTask.exec(a),u&&(p="[ ] "!==u[0],a=a.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:o,task:!!u,checked:p,loose:!1,text:a,tokens:[]}),s.raw+=o}const a=s.items.at(-1);if(!a)return;a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd(),s.raw=s.raw.trimEnd();for(let e=0;e<s.items.length;e++)if(this.lexer.state.top=!1,s.items[e].tokens=this.lexer.blockTokens(s.items[e].text,[]),!s.loose){const t=s.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>this.rules.other.anyLine.test(e.raw)));s.loose=n}if(s.loose)for(let e=0;e<s.items.length;e++)s.items[e].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t){return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:o}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!this.rules.other.tableDelimiter.test(t[2]))return;const n=me(t[1]),o=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===o.length){for(const e of o)this.rules.other.tableAlignRight.test(e)?i.align.push("right"):this.rules.other.tableAlignCenter.test(e)?i.align.push("center"):this.rules.other.tableAlignLeft.test(e)?i.align.push("left"):i.align.push(null);for(let e=0;e<n.length;e++)i.header.push({text:n[e],tokens:this.lexer.inline(n[e]),header:!0,align:i.align[e]});for(const e of s)i.rows.push(me(e,i.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:i.align[t]}))));return i}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;const t=ye(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let o=0;o<e.length;o++)if("\\"===e[o])o++;else if(e[o]===t[0])n++;else if(e[o]===t[1]&&(n--,n<0))return o;return n>0?-2:-1}(t[2],"()");if(-2===e)return;if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],o="";if(this.options.pedantic){const e=this.rules.other.pedanticHrefTitle.exec(n);e&&(n=e[1],o=e[3])}else o=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(n=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n.slice(1):n.slice(1,-1)),xe(t,{href:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n,title:o?o.replace(this.rules.inline.anyPunctuation,"$1"):o},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const e=t[(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return xe(n,e,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!o)return;if(o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(o[1]||o[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const n=[...o[0]].length-1;let s,i,r=n,a=0;const l="*"===o[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+n);null!=(o=l.exec(t));){if(s=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!s)continue;if(i=[...s].length,o[3]||o[4]){r+=i;continue}if((o[5]||o[6])&&n%3&&!((n+i)%3)){a+=i;continue}if(r-=i,r>0)continue;i=Math.min(i,i+r+a);const t=[...o[0]][0].length,l=e.slice(0,n+o.index+t+i);if(Math.min(n,i)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(e),o=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&o&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=t[0],n="mailto:"+e;else{let o;do{o=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(o!==t[0]);e=t[0],n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},ke=class e{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||y,this.options.tokenizer=this.options.tokenizer||new we,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:v,block:he.normal,inline:pe.normal};this.options.pedantic?(t.block=he.pedantic,t.inline=pe.pedantic):this.options.gfm&&(t.block=he.gfm,this.options.breaks?t.inline=pe.breaks:t.inline=pe.gfm),this.tokenizer.rules=t}static get rules(){return{block:he,inline:pe}}static lex(t,n){return new e(n).lex(t)}static lexInline(t,n){return new e(n).inlineTokens(t)}lex(e){e=e.replace(v.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(v.tabCharGlobal,"    ").replace(v.spaceLine,""));e;){let o;if(this.options.extensions?.block?.some((n=>!!(o=n.call({lexer:this},e,t))&&(e=e.substring(o.raw.length),t.push(o),!0))))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const n=t.at(-1);1===o.raw.length&&void 0!==n?n.raw+="\n":t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+o.raw,n.text+="\n"+o.text,this.inlineQueue.at(-1).src=n.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+o.raw,n.text+="\n"+o.raw,this.inlineQueue.at(-1).src=n.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let s=e;if(this.options.extensions?.startBlock){let t=1/0;const n=e.slice(1);let o;this.options.extensions.startBlock.forEach((e=>{o=e.call({lexer:this},n),"number"==typeof o&&o>=0&&(t=Math.min(t,o))})),t<1/0&&t>=0&&(s=e.substring(0,t+1))}if(this.state.top&&(o=this.tokenizer.paragraph(s))){const i=t.at(-1);n&&"paragraph"===i?.type?(i.raw+="\n"+o.raw,i.text+="\n"+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):t.push(o),n=s.length!==e.length,e=e.substring(o.raw.length)}else if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const n=t.at(-1);"text"===n?.type?(n.raw+="\n"+o.raw,n.text+="\n"+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(o)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,o=null;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(o=this.tokenizer.rules.inline.reflinkSearch.exec(n));)e.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(o=this.tokenizer.rules.inline.anyPunctuation.exec(n));)n=n.slice(0,o.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(o=this.tokenizer.rules.inline.blockSkip.exec(n));)n=n.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,i="";for(;e;){let o;if(s||(i=""),s=!1,this.options.extensions?.inline?.some((n=>!!(o=n.call({lexer:this},e,t))&&(e=e.substring(o.raw.length),t.push(o),!0))))continue;if(o=this.tokenizer.escape(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.tag(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.link(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(o.raw.length);const n=t.at(-1);"text"===o.type&&"text"===n?.type?(n.raw+=o.raw,n.text+=o.text):t.push(o);continue}if(o=this.tokenizer.emStrong(e,n,i)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.codespan(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.br(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.del(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.autolink(e)){e=e.substring(o.raw.length),t.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(e))){e=e.substring(o.raw.length),t.push(o);continue}let r=e;if(this.options.extensions?.startInline){let t=1/0;const n=e.slice(1);let o;this.options.extensions.startInline.forEach((e=>{o=e.call({lexer:this},n),"number"==typeof o&&o>=0&&(t=Math.min(t,o))})),t<1/0&&t>=0&&(r=e.substring(0,t+1))}if(o=this.tokenizer.inlineText(r)){e=e.substring(o.raw.length),"_"!==o.raw.slice(-1)&&(i=o.raw.slice(-1)),s=!0;const n=t.at(-1);"text"===n?.type?(n.raw+=o.raw,n.text+=o.text):t.push(o)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}},ve=class{options;parser;constructor(e){this.options=e||y}space(e){return""}code({text:e,lang:t,escaped:n}){const o=(t||"").match(v.notSpaceStart)?.[0],s=e.replace(v.endingNewline,"")+"\n";return o?'<pre><code class="language-'+fe(o)+'">'+(n?s:fe(s,!0))+"</code></pre>\n":"<pre><code>"+(n?s:fe(s,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,n=e.start;let o="";for(let t=0;t<e.items.length;t++){const n=e.items[t];o+=this.listitem(n)}const s=t?"ol":"ul";return"<"+s+(t&&1!==n?' start="'+n+'"':"")+">\n"+o+"</"+s+">\n"}listitem(e){let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?"paragraph"===e.tokens[0]?.type?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=n+" "+fe(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",n="";for(let t=0;t<e.header.length;t++)n+=this.tablecell(e.header[t]);t+=this.tablerow({text:n});let o="";for(let t=0;t<e.rows.length;t++){const s=e.rows[t];n="";for(let e=0;e<s.length;e++)n+=this.tablecell(s[e]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+o+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${fe(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const o=this.parser.parseInline(n),s=be(e);if(null===s)return o;let i='<a href="'+(e=s)+'"';return t&&(i+=' title="'+fe(t)+'"'),i+=">"+o+"</a>",i}image({href:e,title:t,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));const s=be(e);if(null===s)return fe(n);let i=`<img src="${e=s}" alt="${n}"`;return t&&(i+=` title="${fe(t)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:fe(e.text)}},_e=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},Ce=class e{options;renderer;textRenderer;constructor(e){this.options=e||y,this.options.renderer=this.options.renderer||new ve,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _e}static parse(t,n){return new e(n).parse(t)}static parseInline(t,n){return new e(n).parseInline(t)}parse(e,t=!0){let n="";for(let o=0;o<e.length;o++){const s=e[o];if(this.options.extensions?.renderers?.[s.type]){const e=s,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}const i=s;switch(i.type){case"space":n+=this.renderer.space(i);continue;case"hr":n+=this.renderer.hr(i);continue;case"heading":n+=this.renderer.heading(i);continue;case"code":n+=this.renderer.code(i);continue;case"table":n+=this.renderer.table(i);continue;case"blockquote":n+=this.renderer.blockquote(i);continue;case"list":n+=this.renderer.list(i);continue;case"html":n+=this.renderer.html(i);continue;case"paragraph":n+=this.renderer.paragraph(i);continue;case"text":{let s=i,r=this.renderer.text(s);for(;o+1<e.length&&"text"===e[o+1].type;)s=e[++o],r+="\n"+this.renderer.text(s);n+=t?this.renderer.paragraph({type:"paragraph",raw:r,text:r,tokens:[{type:"text",raw:r,text:r,escaped:!0}]}):r;continue}default:{const e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t=this.renderer){let n="";for(let o=0;o<e.length;o++){const s=e[o];if(this.options.extensions?.renderers?.[s.type]){const e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=e||"";continue}}const i=s;switch(i.type){case"escape":case"text":n+=t.text(i);break;case"html":n+=t.html(i);break;case"link":n+=t.link(i);break;case"image":n+=t.image(i);break;case"strong":n+=t.strong(i);break;case"em":n+=t.em(i);break;case"codespan":n+=t.codespan(i);break;case"br":n+=t.br(i);break;case"del":n+=t.del(i);break;default:{const e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}},Te=class{options;block;constructor(e){this.options=e||y}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?ke.lex:ke.lexInline}provideParser(){return this.block?Ce.parse:Ce.parseInline}},Be=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ce;Renderer=ve;TextRenderer=_e;Lexer=ke;Tokenizer=we;Hooks=Te;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(const o of e)switch(n=n.concat(t.call(this,o)),o.type){case"table":{const e=o;for(const o of e.header)n=n.concat(this.walkTokens(o.tokens,t));for(const o of e.rows)for(const e of o)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=o;n=n.concat(this.walkTokens(e.items,t));break}default:{const e=o;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((o=>{const s=e[o].flat(1/0);n=n.concat(this.walkTokens(s,t))})):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let o=e.renderer.apply(this,t);return!1===o&&(o=n.apply(this,t)),o}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer){const t=this.defaults.renderer||new ve(this.defaults);for(const n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const o=n,s=e.renderer[o],i=t[o];t[o]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=i.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new we(this.defaults);for(const n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const o=n,s=e.tokenizer[o],i=t[o];t[o]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=i.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new Te;for(const n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;const o=n,s=e.hooks[o],i=t[o];Te.passThroughHooks.has(n)?t[o]=e=>{if(this.defaults.async)return Promise.resolve(s.call(t,e)).then((e=>i.call(t,e)));const n=s.call(t,e);return i.call(t,n)}:t[o]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=i.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,o=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(o.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return ke.lex(e,t??this.defaults)}parser(e,t){return Ce.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{const o={...n},s={...this.defaults,...o},i=this.onError(!!s.silent,!!s.async);if(!0===this.defaults.async&&!1===o.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=e);const r=s.hooks?s.hooks.provideLexer():e?ke.lex:ke.lexInline,a=s.hooks?s.hooks.provideParser():e?Ce.parse:Ce.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then((e=>r(e,s))).then((e=>s.hooks?s.hooks.processAllTokens(e):e)).then((e=>s.walkTokens?Promise.all(this.walkTokens(e,s.walkTokens)).then((()=>e)):e)).then((e=>a(e,s))).then((e=>s.hooks?s.hooks.postprocess(e):e)).catch(i);try{s.hooks&&(t=s.hooks.preprocess(t));let e=r(t,s);s.hooks&&(e=s.hooks.processAllTokens(e)),s.walkTokens&&this.walkTokens(e,s.walkTokens);let n=a(e,s);return s.hooks&&(n=s.hooks.postprocess(n)),n}catch(e){return i(e)}}}onError(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+fe(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function Se(e,t){return Be.parse(e,t)}Se.options=Se.setOptions=function(e){return Be.setOptions(e),Se.defaults=Be.defaults,x(Se.defaults),Se},Se.getDefaults=m,Se.defaults=y,Se.use=function(...e){return Be.use(...e),Se.defaults=Be.defaults,x(Se.defaults),Se},Se.walkTokens=function(e,t){return Be.walkTokens(e,t)},Se.parseInline=Be.parseInline,Se.Parser=Ce,Se.parser=Ce.parse,Se.Renderer=ve,Se.TextRenderer=_e,Se.Lexer=ke,Se.lexer=ke.lex,Se.Tokenizer=we,Se.Hooks=Te,Se.parse=Se;Se.options,Se.setOptions,Se.use,Se.walkTokens,Se.parseInline,Ce.parse,ke.lex;Se.setOptions({sanitize:!0,breaks:!0,gfm:!0,headerIds:!1,mangle:!1}),function(){class e{constructor(e){this.host="mijm9dav2z.us-east-1.awsapprunner.com",this.config={shared_id:"",authentication_token:"",chat_title:"Chat with Us",assistant_name:"Assistant",assistant_subtitle:"",header_color:"#4a86e8",show_avatar:!0,assistant_chat_bubble_color:"#f0f0f0",assistant_avatar_url:"https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/park-ranger.png",user_avatar_url:"https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png",profile_icon_url:"https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png",profile_chat_bubble_color:"#4a86e8",agent:!1,privacy_policy:{enabled:!1,text_prefix:"By chatting, you agree to our",link_text:"privacy policy",text_suffix:".",content_type:"markdown",markdown_content:"",page_url:"",popup_title:"Privacy Policy"},api_url:"https://6jnsawhzi2.us-east-1.awsapprunner.com/api/v1/chats_openai",feedback_api_url:"https://6jnsawhzi2.us-east-1.awsapprunner.com/v1/conversation/thumbup",features:{greeting_overlays:!0,notification_badge:!0,expanded_mode:!0,timestamps:!0,scroll_to_bottom_button:!0,sound_effects:!1,tab_title_notifications:!0,inactivity_nudge:!1,input_toolbar:!1,attachments:!1,emoji_picker:!1,mic_input:!1,new_message_divider:!0}},e&&(this.config={...this.config,...e,features:{...this.config.features,...e.features||{}},privacy_policy:{...this.config.privacy_policy,...e.privacy_policy||{}}}),this.conversationHistory=[],this.isOpen=!1,this.isExpanded=!1,this.unreadCount=0,this.lastActivityTime=Date.now(),this.inactivityTimer=null,this.tabTitleInterval=null,this.originalTabTitle=document.title,this.init()}async getNewSession(){try{const e=this.config.agent?`https://${this.host}/api/v1/agents/${this.config.shared_id}/completions`:`https://${this.host}/api/v1/chats/${this.config.shared_id}/completions`;console.log(`Getting new session from: ${e}`);const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.authentication_token}`},body:JSON.stringify({question:"",stream:!0})});if(!t.ok)throw new Error(`Failed to get new session: ${t.status}`);const n=t.body.getReader(),o=new TextDecoder;let s=null,i=null;for(;;){const{done:e,value:t}=await n.read();if(e)break;const r=o.decode(t,{stream:!0}).split("\n").filter((e=>""!==e.trim()));for(const e of r)if(e.startsWith("data:"))try{const t=e.substring(5);console.log(`Received SSE data: ${t}`);const n=JSON.parse(t);n.data&&n.data.session_id&&(s=n.data.session_id,i=n.data.answer,console.log(`New session ID: ${s}`),console.log(`Welcome message: ${i}`))}catch(e){console.error("Error parsing SSE data:",e)}}if(s){if(this.sessionId=s,localStorage.setItem(`yodel-chat-session-${this.config.shared_id}`,s),localStorage.setItem(`yodel-chat-session-ts-${this.config.shared_id}`,Date.now().toString()),this.inputBox&&this.sendButton&&(this.inputBox.disabled=!1,this.sendButton.disabled=!1),i)if(this.sessionInitMessageId){const e=document.getElementById(this.sessionInitMessageId);if(e){const t=e.querySelector(".yodel-bubble"),n=e.querySelector(".yodel-content-container");t&&(t.innerHTML=this.formatMessageContent(i)),n&&this.addMessageActions(n,i)}else this.appendMessageToUI("assistant",i);this.sessionInitMessageId=null}else this.appendMessageToUI("assistant",i);return s}}catch(e){if(console.error("Error getting new session:",e),this.sessionInitMessageId){const e=document.getElementById(this.sessionInitMessageId);if(e){const t=e.querySelector(".yodel-bubble");t&&(t.innerHTML="Failed to connect. Please try again.")}this.sessionInitMessageId=null}this.inputBox&&this.sendButton&&(this.inputBox.disabled=!1,this.sendButton.disabled=!1)}return null}validatePrivacyConfig(){const e=this.config.privacy_policy;if(!e||!e.enabled)return!0;if(!e.link_text||""===e.link_text.trim())return console.error("Privacy policy link text is required when privacy policy is enabled"),!1;if("markdown"===e.content_type){if(!e.markdown_content||""===e.markdown_content.trim())return console.error('Markdown content is required when content_type is set to "markdown"'),!1;if(e.markdown_content.length>5e4)return console.error("Privacy policy markdown content exceeds maximum length of 50,000 characters"),!1}else{if("url"!==e.content_type)return console.error('Invalid privacy policy content_type. Must be "markdown" or "url"'),!1;if(!e.page_url||""===e.page_url.trim())return console.error('Page URL is required when content_type is set to "url"'),!1;try{new URL(e.page_url)}catch(e){return console.error("Invalid privacy policy URL format"),!1}}return!0}createPrivacyBanner(){const e=this.config.privacy_policy,t=document.createElement("div");if(t.className="yodel-privacy-banner",t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),e.text_prefix&&""!==e.text_prefix.trim()){const n=document.createElement("span");n.textContent=e.text_prefix+" ",t.appendChild(n)}const n=document.createElement("a");if(n.className="yodel-privacy-link",n.textContent=e.link_text||"privacy policy","url"===e.content_type&&e.page_url?(n.href=e.page_url,n.target="_blank",n.rel="noopener noreferrer",n.setAttribute("aria-label","Open Privacy Policy in new tab")):(n.href="#",n.setAttribute("aria-label","Open Privacy Policy"),n.setAttribute("role","button"),n.addEventListener("click",(e=>{e.preventDefault(),this.showPrivacyPopup()}))),t.appendChild(n),e.text_suffix&&""!==e.text_suffix.trim()){const n=document.createElement("span");n.textContent=" "+e.text_suffix,t.appendChild(n)}return t}showPrivacyPopup(){const e=this.config.privacy_policy;this.hidePrivacyPopup();const t=document.createElement("div");t.className="yodel-privacy-overlay",t.setAttribute("aria-hidden","true");const n=document.createElement("div");n.className="yodel-privacy-popup",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-labelledby","yodel-privacy-title");const o=document.createElement("div");o.className="yodel-privacy-header";const s=document.createElement("h2");s.id="yodel-privacy-title",s.className="yodel-privacy-title",s.textContent=e.popup_title||"Privacy Policy",o.appendChild(s);const i=document.createElement("button");i.className="yodel-privacy-close",i.setAttribute("aria-label","Close privacy policy"),i.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#333333">\n          <path d="M0 0h24v24H0V0z" fill="none"/>\n          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>\n        </svg>\n      ',i.addEventListener("click",(()=>this.hidePrivacyPopup())),o.appendChild(i);const r=document.createElement("div");r.className="yodel-privacy-content",this.privacyContentContainer=r,n.appendChild(o),n.appendChild(r),this.widgetContainer.appendChild(t),this.widgetContainer.appendChild(n),this.privacyOverlay=t,this.privacyPopup=n,this.renderPrivacyContent(),document.addEventListener("keydown",this.handlePrivacyPopupKeydown),this.previouslyFocusedElement=document.activeElement,i.focus()}handlePrivacyPopupKeydown=e=>{"Escape"===e.key&&this.hidePrivacyPopup()};hidePrivacyPopup(){this.privacyOverlay&&(this.widgetContainer.removeChild(this.privacyOverlay),this.privacyOverlay=null),this.privacyPopup&&(this.widgetContainer.removeChild(this.privacyPopup),this.privacyPopup=null,this.privacyContentContainer=null),document.removeEventListener("keydown",this.handlePrivacyPopupKeydown),this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null)}renderPrivacyContent(){if(!this.privacyContentContainer)return;const e=this.config.privacy_policy;if(this.privacyContentContainer.innerHTML='\n        <div class="yodel-privacy-loading">\n          <div class="yodel-loading-dots">\n            <div></div>\n            <div></div>\n            <div></div>\n          </div>\n        </div>\n      ',"markdown"===e.content_type)try{const t=Se.parse(e.markdown_content);this.privacyContentContainer.innerHTML=t}catch(e){console.error("Error parsing privacy policy markdown:",e),this.privacyContentContainer.innerHTML='\n            <div class="yodel-privacy-error">\n              There was an error loading the privacy policy. Please try again later.\n            </div>\n          '}else if("url"===e.content_type){const t=document.createElement("iframe");let n;t.className="yodel-privacy-iframe",t.src=e.page_url,t.title=e.popup_title||"Privacy Policy",t.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups"),t.addEventListener("load",(()=>{clearTimeout(n),this.privacyContentContainer.innerHTML="",this.privacyContentContainer.appendChild(t)})),t.addEventListener("error",(()=>{clearTimeout(n),this.privacyContentContainer.innerHTML='\n            <div class="yodel-privacy-error">\n              There was an error loading the privacy policy URL. Please try again later.\n            </div>\n          '})),n=setTimeout((()=>{this.privacyContentContainer.innerHTML='\n            <div class="yodel-privacy-error">\n              The privacy policy timed out while loading. Please check the URL and try again.\n            </div>\n          '}),15e3),this.privacyContentContainer.innerHTML="",this.privacyContentContainer.appendChild(t)}}async init(){if(this.config.privacy_policy&&this.config.privacy_policy.enabled){this.validatePrivacyConfig()||(console.error("Invalid privacy policy configuration. Privacy policy will be disabled."),this.config.privacy_policy.enabled=!1)}this.sessionId=localStorage.getItem(`yodel-chat-session-${this.config.shared_id}`)||null,console.log(`Session ID loaded from storage: ${this.sessionId}`);try{const e=`yodel-chat-session-ts-${this.config.shared_id}`,t=localStorage.getItem(e),n=Date.now();let o=!1;if(t){const e=parseInt(t,10);Number.isFinite(e)&&n-e>36e5&&(o=!0)}else this.sessionId&&(o=!0);o&&(console.log("Existing session is expired (>1 hour). Clearing session and history."),this.sessionId=null,localStorage.removeItem(`yodel-chat-session-${this.config.shared_id}`),localStorage.removeItem(e),localStorage.removeItem(`yodel_chat_history_${this.config.shared_id}`),this.conversationHistory=[])}catch(e){console.warn("Error while checking session expiry:",e)}this.loadConversationHistory(),this.isExpanded=!1,this.config.features.expanded_mode&&localStorage.setItem(`yodel_chat_expanded_${this.config.shared_id}`,"false"),this.createWidgetElements(),this.attachEventListeners(),this.sessionId||(console.log("No session ID found, getting a new session..."),await this.getNewSession()),localStorage.setItem(`yodel_chat_open_${this.config.shared_id}`,"false"),this.config.features.greeting_overlays&&this.showGreetingOverlays(),this.config.features.timestamps&&setInterval((()=>this.updateTimestamps()),6e4)}loadConversationHistory(){const e=`yodel_chat_history_${this.config.shared_id}`,t=localStorage.getItem(e);if(t)try{this.conversationHistory=JSON.parse(t)}catch(t){console.error("Failed to parse stored chat history:",t),localStorage.removeItem(e),this.conversationHistory=[]}}saveConversationHistory(){const e=`yodel_chat_history_${this.config.shared_id}`;localStorage.setItem(e,JSON.stringify(this.conversationHistory))}createWidgetElements(){if(this.widgetContainer=document.createElement("div"),this.widgetContainer.className="yodel-chat-widget",this.widgetContainer.style.setProperty("--widget-button-color",this.config.widget_button_color||"#4a86e8"),this.widgetContainer.style.setProperty("--assistant-font-color",this.config.assistant_chat_font_color||"#333333"),this.chatButton=document.createElement("button"),this.chatButton.className="yodel-chat-button",this.chatButton.setAttribute("aria-label","Open chat"),this.chatButton.style.backgroundColor=this.config.widget_button_color||"#4a86e8",this.config.profile_icon_url){const e=document.createElement("img");e.src=this.config.profile_icon_url,e.alt="Chat",this.chatButton.appendChild(e)}else this.chatButton.innerHTML='\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="white"/>\n          </svg>\n        ';this.config.features.notification_badge&&(this.notificationBadge=document.createElement("div"),this.notificationBadge.className="yodel-notification-badge",this.notificationBadge.style.display="none",this.chatButton.appendChild(this.notificationBadge)),this.chatWindow=document.createElement("div"),this.chatWindow.className="yodel-chat-window",this.chatWindow.style.display="none",this.chatHeader=document.createElement("div"),this.chatHeader.className="yodel-chat-header",this.chatHeader.style.backgroundColor=this.config.header_color;const e=document.createElement("div");if(e.className="yodel-header-left",this.config.show_avatar&&this.config.assistant_avatar_url){const t=document.createElement("div");t.className="yodel-header-avatar";const n=document.createElement("img");n.src=this.config.assistant_avatar_url,n.alt=this.config.assistant_name||"Assistant",t.appendChild(n),e.appendChild(t)}const t=document.createElement("div");t.className="yodel-header-title-container";const n=document.createElement("div");if(n.className="yodel-chat-title",n.textContent=this.config.chat_title,t.appendChild(n),this.config.assistant_subtitle){const e=document.createElement("div");e.className="yodel-chat-subtitle",e.textContent=this.config.assistant_subtitle,t.appendChild(e)}e.appendChild(t);const o=document.createElement("div");o.className="yodel-header-right";const s=document.createElement("button");if(s.className="yodel-chat-reset",s.setAttribute("aria-label","Reset chat"),s.setAttribute("title","Reset Chat"),s.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffffff">\n          <path d="M0 0h24v24H0V0z" fill="none"/>\n          <path d="M17.65 6.35c-1.63-1.63-3.94-2.57-6.48-2.31-3.67.37-6.69 3.35-7.10 7.02C3.52 15.91 7.27 20 12 20c3.19 0 5.93-1.87 7.21-4.56.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53-1.13 2.43-3.84 3.97-6.8 3.31-2.22-.49-4.01-2.3-4.48-4.52C5.31 9.44 8.26 6 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71l-.64.65z"/>\n        </svg>\n      ',o.appendChild(s),this.config.features.expanded_mode){const e=document.createElement("button");e.className="yodel-chat-expand",e.setAttribute("aria-label","Expand chat"),e.setAttribute("title","Expand Chat"),e.innerHTML='\n          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffffff">\n            <path d="M0 0h24v24H0V0z" fill="none"/>\n            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>\n          </svg>\n        ',this.expandButton=e,o.appendChild(e)}const i=document.createElement("button");i.className="yodel-chat-close",i.setAttribute("aria-label","Close chat"),i.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffffff">\n          <path d="M0 0h24v24H0V0z" fill="none"/>\n          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>\n        </svg>\n      ',o.appendChild(i),this.chatHeader.appendChild(e),this.chatHeader.appendChild(o);const r=document.createElement("div");r.className="yodel-messages-wrapper",this.messagesContainer=document.createElement("div"),this.messagesContainer.className="yodel-chat-messages",this.messagesContainer.setAttribute("role","log"),this.messagesContainer.setAttribute("aria-live","polite"),r.appendChild(this.messagesContainer),this.config.features.scroll_to_bottom_button&&(this.scrollToBottomBtn=document.createElement("button"),this.scrollToBottomBtn.className="yodel-scroll-to-bottom",this.scrollToBottomBtn.setAttribute("aria-label","Scroll to bottom"),this.scrollToBottomBtn.style.display="none",this.scrollToBottomBtn.innerHTML='\n          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="currentColor">\n            <path d="M0 0h24v24H0V0z" fill="none"/>\n            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>\n          </svg>\n        ',r.appendChild(this.scrollToBottomBtn)),this.inputArea=document.createElement("div"),this.inputArea.className="yodel-chat-input-area";const a=document.createElement("div");a.className="yodel-input-wrapper";const l=document.createElement("textarea");l.className="yodel-chat-input",l.placeholder="Type a message...",l.setAttribute("rows","1"),l.setAttribute("aria-label","Type a message");const c=document.createElement("button");c.className="yodel-chat-send",c.setAttribute("aria-label","Send message"),c.style.backgroundColor=this.config.widget_button_color||"#4a86e8",c.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z"/></svg>\n      ',a.appendChild(l),a.appendChild(c),this.inputArea.appendChild(a),this.config.privacy_policy&&this.config.privacy_policy.enabled&&(this.privacyBanner=this.createPrivacyBanner()),this.chatWindow.appendChild(this.chatHeader),this.privacyBanner&&this.chatWindow.appendChild(this.privacyBanner),this.chatWindow.appendChild(r),this.chatWindow.appendChild(this.inputArea),this.isExpanded&&this.config.features.expanded_mode&&this.chatWindow.classList.add("yodel-expanded"),this.widgetContainer.appendChild(this.chatButton),this.widgetContainer.appendChild(this.chatWindow),document.body.appendChild(this.widgetContainer),this.inputBox=l,this.sendButton=c,this.closeButton=i,this.resetButton=s,this.renderExistingMessages()}renderExistingMessages(){0!==this.conversationHistory.length&&(this.messagesContainer.innerHTML="",this.conversationHistory.forEach((e=>{this.appendMessageToUI(e.role,e.content)})),this.scrollToBottom())}attachEventListeners(){this.chatButton.addEventListener("click",(()=>{this.isOpen?this.closeChat():(this.openChat(),this.clearChat())})),this.closeButton.addEventListener("click",(()=>{this.closeChat()})),this.resetButton.addEventListener("click",(()=>{this.confirmAndClearChat()})),this.sendButton.addEventListener("click",(()=>{this.sendMessage()})),this.inputBox.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())})),this.inputBox.addEventListener("input",(()=>{this.autoResizeInput();const e=""===this.inputBox.value.trim();this.sendButton.disabled=e})),this.sendButton.disabled=!0,this.expandButton&&this.expandButton.addEventListener("click",(()=>{this.toggleExpandedMode()})),this.scrollToBottomBtn&&this.scrollToBottomBtn.addEventListener("click",(()=>{this.scrollToBottom()})),this.config.features.scroll_to_bottom_button&&this.messagesContainer.addEventListener("scroll",(()=>{this.checkScrollPosition()}))}autoResizeInput(){this.inputBox.style.height="auto";const e=Math.min(this.inputBox.scrollHeight,150);this.inputBox.style.height=`${e}px`}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){this.chatWindow.style.display="flex",this.isOpen=!0,this.removeGreetingOverlays(),this.updateNotificationBadge(0),this.widgetContainer.classList.add("yodel-chat-open"),window.innerWidth<640&&(this.scrollPosition=window.pageYOffset||document.documentElement.scrollTop,this.originalBodyStyles={overflow:document.body.style.overflow,position:document.body.style.position,top:document.body.style.top,width:document.body.style.width,left:document.body.style.left,right:document.body.style.right},document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${this.scrollPosition}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.width="100%"),localStorage.setItem(`yodel_chat_open_${this.config.shared_id}`,"true"),setTimeout((()=>{this.inputBox.focus()}),300),this.scrollToBottom()}closeChat(){this.chatWindow.style.display="none",this.isOpen=!1,this.config.features.greeting_overlays&&setTimeout((()=>{this.showGreetingOverlays()}),500),this.widgetContainer.classList.remove("yodel-chat-open"),window.innerWidth<640&&this.originalBodyStyles&&(document.body.style.overflow=this.originalBodyStyles.overflow,document.body.style.position=this.originalBodyStyles.position,document.body.style.top=this.originalBodyStyles.top,document.body.style.width=this.originalBodyStyles.width,document.body.style.left=this.originalBodyStyles.left,document.body.style.right=this.originalBodyStyles.right,void 0!==this.scrollPosition&&(window.scrollTo(0,this.scrollPosition),this.scrollPosition=void 0),this.originalBodyStyles=null),localStorage.setItem(`yodel_chat_open_${this.config.shared_id}`,"false")}scrollToBottom(){this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}sendMessage(){const e=this.inputBox.value.trim();e&&(this.inputBox.disabled=!0,this.sendButton.disabled=!0,this.inputBox.value="",this.autoResizeInput(),this.appendMessageToUI("user",e),this.conversationHistory.push({role:"user",content:e}),this.saveConversationHistory(),this.scrollToBottom(),this.sendMessageToServer(e),this.inputBox.disabled=!1,this.sendButton.disabled=!1,this.inputBox.focus())}formatMessageContent(e){try{return Se.parse(e)}catch(t){return console.error("Error parsing Markdown:",t),e.replace(/\n/g,"<br>")}}handleFeedback(e,t,n,o,s){o.classList.toggle("selected",t),s.classList.toggle("selected",!t),o.disabled=!0,s.disabled=!0,localStorage.setItem(`yodel_feedback_${e}`,t?"up":"down");const i={thumbup:t,message_id:e,conversation_id:this.config.shared_id};!t&&n&&(i.feedback=n),fetch(this.config.feedback_api_url,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.authentication_token}`,Accept:"application/json"},body:JSON.stringify(i)}).then((e=>{if(!e.ok)throw new Error(`API request failed with status ${e.status}`);return e.json()})).then((e=>{console.log("Feedback submitted successfully:",e)})).catch((t=>{console.error("Error submitting feedback:",t),this.showToast("Could not send feedback. Please try again."),o.disabled=!1,s.disabled=!1,o.classList.remove("selected"),s.classList.remove("selected"),localStorage.removeItem(`yodel_feedback_${e}`)}))}showToast(e){const t=document.querySelector(".yodel-toast");t&&document.body.removeChild(t);const n=document.createElement("div");n.className="yodel-toast",n.textContent=e,document.body.appendChild(n),n.offsetHeight,n.classList.add("show"),setTimeout((()=>{n.classList.remove("show"),setTimeout((()=>{n.parentNode&&document.body.removeChild(n)}),300)}),3e3)}appendMessageToUI(e,t){const n=document.createElement("div");if(n.className=`yodel-message yodel-message-${e}`,this.config.show_avatar){const t=document.createElement("div");if(t.className="yodel-avatar","assistant"===e&&this.config.assistant_avatar_url){const e=document.createElement("img");e.src=this.config.assistant_avatar_url,e.alt="Assistant",t.appendChild(e)}else if("user"===e&&this.config.user_avatar_url){const e=document.createElement("img");e.src=this.config.user_avatar_url,e.alt="User",t.appendChild(e)}else t.textContent=e.charAt(0).toUpperCase();n.appendChild(t)}const o=document.createElement("div");o.className="yodel-content-container",n.appendChild(o);const s=document.createElement("div");s.className="yodel-bubble","assistant"===e?(s.style.backgroundColor=this.config.assistant_chat_bubble_color||"#f0f0f0",s.style.color=this.config.assistant_chat_font_color||"#333"):(s.style.backgroundColor=this.config.profile_chat_bubble_color||"#4a86e8",s.style.color=this.config.profile_chat_font_color||"#fff"),s.innerHTML=this.formatMessageContent(t),o.appendChild(s),"assistant"===e&&this.addMessageActions(o,t),this.messagesContainer.appendChild(n)}addMessageActions(e,t){const n=document.createElement("div");n.className="yodel-message-actions",n.setAttribute("data-message-id",`msg-${Date.now()}-${Math.random().toString(36).substring(2,7)}`);const o=document.createElement("button");o.className="yodel-message-action-button yodel-copy-button",o.setAttribute("aria-label","Copy to clipboard"),o.setAttribute("title","Copy to clipboard"),o.innerHTML='\n        <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n        </svg>\n      ';o.innerHTML+='\n        <svg class="checkmark-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#28a745" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <polyline points="20 6 9 17 4 12"></polyline>\n        </svg>\n      ',o.addEventListener("click",(()=>{this.copyToClipboard(t,o)})),n.appendChild(o),e.appendChild(n)}copyToClipboard(e,t){const n=e.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]*>/g,"");navigator.clipboard?navigator.clipboard.writeText(n).then((()=>{this.showCopySuccess(t)})).catch((e=>{console.error("Failed to copy text:",e),this.fallbackCopyToClipboard(n,t)})):this.fallbackCopyToClipboard(n,t)}fallbackCopyToClipboard(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",n.style.top="-9999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")?this.showCopySuccess(t):console.error("Failed to copy text with execCommand")}catch(e){console.error("Error during execCommand copy:",e)}document.body.removeChild(n)}showCopySuccess(e){const t=e.querySelector(".copy-icon"),n=e.querySelector(".checkmark-icon");t&&n&&(t.style.display="none",n.style.display="inline-block",setTimeout((()=>{t.style.display="inline-block",n.style.display="none"}),2e3))}appendEmptyMessageToUI(e,t){const n=document.createElement("div");if(n.className=`yodel-message yodel-message-${e}`,n.id=t,this.config.show_avatar){const t=document.createElement("div");if(t.className="yodel-avatar","assistant"===e&&this.config.assistant_avatar_url){const e=document.createElement("img");e.src=this.config.assistant_avatar_url,e.alt="Assistant",t.appendChild(e)}else if("user"===e&&this.config.user_avatar_url){const e=document.createElement("img");e.src=this.config.user_avatar_url,e.alt="User",t.appendChild(e)}else t.textContent=e.charAt(0).toUpperCase();n.appendChild(t)}const o=document.createElement("div");o.className="yodel-content-container",n.appendChild(o);const s=document.createElement("div");return s.className="yodel-bubble","assistant"===e?(s.style.backgroundColor=this.config.assistant_chat_bubble_color||"#f0f0f0",s.style.color=this.config.assistant_chat_font_color||"#333"):(s.style.backgroundColor=this.config.profile_chat_bubble_color||"#4a86e8",s.style.color=this.config.profile_chat_font_color||"#fff"),s.innerHTML='<span class="yodel-streaming-cursor"></span>',o.appendChild(s),this.messagesContainer.appendChild(n),this.scrollToBottom(),{messageElement:n,bubble:s,contentContainer:o}}showLoadingIndicator(){}removeLoadingIndicator(){}sendMessageToServer(e){let t,n;this.config.agent?(t=`https://${this.host}/api/v1/agents/${this.config.shared_id}/completions`,n={question:e,stream:!0},this.sessionId&&(console.log(`Using session ID for request: ${this.sessionId}`),n.session_id=this.sessionId)):(t=`https://${this.host}/api/v1/chats/${this.config.shared_id}/completions`,n={question:e,stream:!0},this.sessionId&&(console.log(`Using session ID for request: ${this.sessionId}`),n.session_id=this.sessionId));const o=`msg-${Date.now()}`;this.appendEmptyMessageToUI("assistant",o),fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.authentication_token}`},body:JSON.stringify(n)}).then((e=>{if(!e.ok)throw new Error(`API request failed with status ${e.status}`);if(!e.headers.get("content-type")?.includes("text/event-stream"))return e.json().then((e=>{this.handleServerResponse(e)}));this.handleStreamingResponse(e,o)})).catch((e=>{console.error("Error sending message:",e),this.handleErrorResponse(e)}))}handleStreamingResponse(e,t){const n=document.getElementById(t);if(!n)return void console.error("Message element not found:",t);const o=n.querySelector(".yodel-bubble");if(!o)return void console.error("Message bubble not found in:",t);let s="";const i=e.body.getReader(),r=new TextDecoder("utf-8"),a=()=>{i.read().then((({done:e,value:t})=>{if(e){o.innerHTML=this.formatMessageContent(s);const e=n.querySelector(".yodel-content-container");return e&&this.addMessageActions(e,s),this.conversationHistory.push({role:"assistant",content:s}),void this.saveConversationHistory()}const i=r.decode(t,{stream:!0});console.log("Received chunk:",i);const l=i.split("\n");for(const e of l)if(e.startsWith("data:")){const t=e.substring(5).trim();if("[DONE]"===t){console.log("Received [DONE] marker");continue}try{const e=JSON.parse(t);console.log("Parsed data:",e);let n="";if(e.data&&void 0!==e.data.answer){if(!0===e.data.running_status){console.log("Agent status message:",e.data.answer);let t=e.data.answer;if(t.includes("is running")){const e=t.match(/[*']+([^*']+)[*']+/);t=e&&e[1]?`Processing: ${e[1]}`:"Processing..."}const n=o.querySelector(".yodel-agent-status");n&&n.remove();const i=document.createElement("div");i.className="yodel-agent-status",i.textContent=t,o.innerHTML=this.formatMessageContent(s)+'<span class="yodel-streaming-cursor"></span>',o.appendChild(i),this.scrollToBottom();continue}const t=e.data.answer;n=t.length>=s.length?t.substring(s.length):t,s=t}else if(e.choices&&e.choices.length>0){const t=e.choices[0];t.delta&&t.delta.content?n=t.delta.content:t.text?n=t.text:t.message&&t.message.content&&(n=t.message.content),n&&(s+=n)}(n||e.data&&void 0!==e.data.answer)&&(console.log("Content extracted:",n||"Full replacement"),o.innerHTML=this.formatMessageContent(s)+'<span class="yodel-streaming-cursor"></span>',this.scrollToBottom())}catch(e){console.error("Error parsing stream data:",e,t)}}a()})).catch((e=>{console.error("Error reading stream:",e)}))};a()}handleServerResponse(e){if(e&&e.choices&&e.choices.length>0){const t=e.choices[0].message.content;this.conversationHistory.push({role:"assistant",content:t}),this.saveConversationHistory(),this.appendMessageToUI("assistant",t),this.scrollToBottom()}else console.error("Invalid response format:",e),this.handleErrorResponse(new Error("Invalid response format"))}handleErrorResponse(e){this.appendMessageToUI("assistant","Sorry, there was an error processing your request. Please try again.",!0),this.scrollToBottom()}confirmAndClearChat(){const e=document.createElement("div");e.className="yodel-confirm-dialog";const t=document.createElement("div");t.className="yodel-confirm-message",t.textContent="Are you sure you want to reset the chat? This will clear all messages.";const n=document.createElement("div");n.className="yodel-confirm-buttons";const o=document.createElement("button");o.className="yodel-confirm-yes",o.textContent="Yes";const s=document.createElement("button");s.className="yodel-confirm-cancel",s.textContent="Cancel",n.appendChild(o),n.appendChild(s),e.appendChild(t),e.appendChild(n);const i=this.chatWindow.querySelector(".yodel-messages-wrapper");i?this.chatWindow.insertBefore(e,i):this.chatWindow.insertBefore(e,this.inputArea),o.addEventListener("click",(()=>{this.clearChat(),this.chatWindow.removeChild(e)})),s.addEventListener("click",(()=>{this.chatWindow.removeChild(e)}))}async clearChat(){this.conversationHistory=[],this.messagesContainer.innerHTML="",this.saveConversationHistory(),this.inputBox&&this.sendButton&&(this.inputBox.disabled=!0,this.sendButton.disabled=!0);const e=`yodel-chat-session-ts-${this.config.shared_id}`;this.sessionId?console.log(`Clearing session ID: ${this.sessionId}`):console.log("Clearing session (no existing session ID)."),this.sessionId=null,localStorage.removeItem(`yodel-chat-session-${this.config.shared_id}`),localStorage.removeItem(e);const t=`init-${Date.now()}`;this.sessionInitMessageId=t;const{bubble:n}=this.appendEmptyMessageToUI("assistant",t)||{};if(n&&(n.innerHTML='Connecting to assistant... <span class="yodel-streaming-cursor"></span>'),console.log("Getting a new session after reset..."),await this.getNewSession(),0===this.messagesContainer.children.length){const e=document.createElement("div");e.className="yodel-message-placeholder",e.textContent="Start a new conversation...",this.messagesContainer.appendChild(e)}this.inputBox.focus(),this.inputBox.style.height="auto"}showGreetingOverlays(){if(!this.config.features.greeting_overlays)return;const e=document.createElement("div");e.className="yodel-greeting-bubble",e.innerHTML=`Hi 👋 I'm ${this.config.assistant_name||"Yodel"}, ask me anything`;const t=document.createElement("div");t.className="yodel-cta-bubble",t.textContent="I have a question",e.addEventListener("click",(()=>{this.openChat(),this.removeGreetingOverlays()})),t.addEventListener("click",(()=>{this.openChat(),this.removeGreetingOverlays()})),this.widgetContainer.appendChild(e),this.widgetContainer.appendChild(t),this.greetingBubble=e,this.ctaBubble=t,setTimeout((()=>{this.removeGreetingOverlays()}),1e4)}removeGreetingOverlays(){this.greetingBubble&&(this.greetingBubble.classList.add("yodel-fade-out"),setTimeout((()=>{this.greetingBubble&&this.greetingBubble.parentNode&&this.widgetContainer.removeChild(this.greetingBubble),this.greetingBubble=null}),300)),this.ctaBubble&&(this.ctaBubble.classList.add("yodel-fade-out"),setTimeout((()=>{this.ctaBubble&&this.ctaBubble.parentNode&&this.widgetContainer.removeChild(this.ctaBubble),this.ctaBubble=null}),300))}updateNotificationBadge(e){this.config.features.notification_badge&&this.notificationBadge&&(this.unreadCount=e,e>0?(this.notificationBadge.textContent=e>9?"9+":e,this.notificationBadge.style.display="flex"):this.notificationBadge.style.display="none")}toggleExpandedMode(){this.config.features.expanded_mode&&(this.isExpanded=!this.isExpanded,this.isExpanded?(this.chatWindow.classList.add("yodel-expanded"),this.widgetContainer.classList.add("yodel-widget-expanded"),this.expandButton&&(this.expandButton.setAttribute("aria-label","Collapse chat"),this.expandButton.setAttribute("title","Collapse Chat"),this.expandButton.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffffff">\n              <path d="M0 0h24v24H0V0z" fill="none"/>\n              <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>\n            </svg>\n          ')):(this.chatWindow.classList.remove("yodel-expanded"),this.widgetContainer.classList.remove("yodel-widget-expanded"),this.expandButton&&(this.expandButton.setAttribute("aria-label","Expand chat"),this.expandButton.setAttribute("title","Expand Chat"),this.expandButton.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffffff">\n              <path d="M0 0h24v24H0V0z" fill="none"/>\n              <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>\n            </svg>\n          ')),localStorage.setItem(`yodel_chat_expanded_${this.config.shared_id}`,this.isExpanded),setTimeout((()=>this.scrollToBottom()),300))}checkScrollPosition(){if(!this.config.features.scroll_to_bottom_button||!this.scrollToBottomBtn)return;const e=this.messagesContainer.scrollHeight-this.messagesContainer.scrollTop<=this.messagesContainer.clientHeight+50;this.scrollToBottomBtn.style.display=e?"none":"flex"}getRelativeTime(e){const t=new Date-e,n=Math.floor(t/1e3),o=Math.floor(n/60),s=Math.floor(o/60),i=Math.floor(s/24);return n<60?"just now":o<60?`${o}m ago`:s<24?`${s}h ago`:i<7?`${i}d ago`:e.toLocaleDateString()}updateTimestamps(){if(!this.config.features.timestamps)return;this.messagesContainer.querySelectorAll(".yodel-message-timestamp").forEach((e=>{const t=e.getAttribute("data-timestamp");if(t){const n=new Date(t);e.textContent=this.getRelativeTime(n)}}))}playSound(e){if(this.config.features.sound_effects)try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),o=t.createGain();n.connect(o),o.connect(t.destination),n.frequency.value="send"===e?800:600,n.type="sine",o.gain.setValueAtTime(.3,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),n.start(t.currentTime),n.stop(t.currentTime+.1)}catch(e){console.warn("Sound playback not supported:",e)}}startTabTitleNotification(){if(!this.config.features.tab_title_notifications)return;if(document.hasFocus())return;let e=!1;this.tabTitleInterval=setInterval((()=>{document.title=e?this.originalTabTitle:`💬 New message - ${this.config.assistant_name||"Assistant"}`,e=!e}),1500);const t=()=>{this.tabTitleInterval&&(clearInterval(this.tabTitleInterval),this.tabTitleInterval=null,document.title=this.originalTabTitle),window.removeEventListener("focus",t)};window.addEventListener("focus",t)}}function t(){const t=window.yodelChatSettings||{};new e(t)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}()})();