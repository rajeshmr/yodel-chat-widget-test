<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yodel Chat Widget - Configuration Tester</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background:rgb(204, 204, 204);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }

    .panel {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .panel-header {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      padding: 20px;
      font-size: 20px;
      font-weight: 600;
    }

    .panel-content {
      padding: 20px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid #e0e0e0;
      margin-bottom: 20px;
      overflow-x: auto;
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border: none;
      background: none;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .tab:hover {
      color: #2563eb;
      background: #f5f5f5;
    }

    .tab.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #333;
      font-size: 14px;
    }

    .form-group input[type="text"],
    .form-group input[type="url"],
    .form-group input[type="color"],
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="url"]:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #2563eb;
    }

    .form-group input[type="color"] {
      height: 45px;
      cursor: pointer;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }

    .form-group small {
      display: block;
      margin-top: 4px;
      color: #666;
      font-size: 12px;
    }

    /* Checkbox */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-group label {
      margin: 0;
      cursor: pointer;
      font-weight: 400;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      width: 100%;
      margin-top: 10px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
      margin-top: 10px;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Code Display */
    .code-container {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      position: relative;
    }

    .code-container pre {
      color: #d4d4d4;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      overflow-x: auto;
      margin: 0;
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 8px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }

    .copy-btn:hover {
      background: #1d4ed8;
    }

    .copy-btn.copied {
      background: #28a745;
    }

    /* Preview Section */
    .preview-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #2563eb;
    }

    .preview-info h3 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #333;
    }

    .preview-info p {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }

    /* Feature Flags Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 12px;
    }

    .feature-card {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border: 2px solid #e0e0e0;
      transition: border-color 0.3s;
    }

    .feature-card:has(input:checked) {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .feature-card .checkbox-group {
      margin: 0;
    }

    .feature-card small {
      display: block;
      margin-top: 4px;
      color: #666;
      font-size: 11px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .status-badge.stable {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.experimental {
      background: #fff3cd;
      color: #856404;
    }

    /* Color Preview */
    .color-preview {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-preview input[type="color"] {
      width: 60px;
    }

    .color-preview input[type="text"] {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Configuration Panel -->
    <div class="panel">
      <div class="panel-header">
        üé® Widget Configuration
      </div>
      <div class="panel-content">
        <div class="tabs">
          <button class="tab active" data-tab="basic">Basic</button>
          <button class="tab" data-tab="colors">Colors</button>
          <button class="tab" data-tab="avatars">Avatars</button>
          <button class="tab" data-tab="features">Features</button>
          <button class="tab" data-tab="privacy">Privacy</button>
          <button class="tab" data-tab="advanced">Advanced</button>
        </div>

        <form id="configForm">
          <!-- Basic Tab -->
          <div class="tab-content active" data-tab="basic">
            <div class="form-group">
              <label for="shared_id">Shared ID *</label>
              <input type="text" id="shared_id" value="e6095c5e9d4311f09e25a9b8b1a79c0c" required>
              <small>Your unique widget identifier</small>
            </div>

            <div class="form-group">
              <label for="authentication_token">Authentication Token *</label>
              <input type="text" id="authentication_token" value="" placeholder="ragflow-xxxxx" required>
              <small>API authentication token</small>
            </div>

            <div class="form-group">
              <label for="chat_title">Chat Title</label>
              <input type="text" id="chat_title" value="Chat with Us">
            </div>

            <div class="form-group">
              <label for="assistant_name">Assistant Name</label>
              <input type="text" id="assistant_name" value="Assistant">
              <small>Name displayed in header</small>
            </div>

            <div class="form-group">
              <label for="assistant_subtitle">Assistant Subtitle</label>
              <input type="text" id="assistant_subtitle" value="" placeholder="The team can also help">
              <small>Optional subtitle below assistant name</small>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="show_avatar" checked>
              <label for="show_avatar">Show Avatars</label>
            </div>

            <div class="checkbox-group">
              <input type="checkbox" id="agent">
              <label for="agent">Use Agent API (instead of Chat API)</label>
            </div>
          </div>

          <!-- Colors Tab -->
          <div class="tab-content" data-tab="colors">
            <div class="form-group">
              <label for="header_color">Header Color</label>
              <div class="color-preview">
                <input type="color" id="header_color" value="#4a86e8">
                <input type="text" id="header_color_text" value="#4a86e8">
              </div>
            </div>

            <div class="form-group">
              <label for="widget_button_color">Widget Button Color</label>
              <div class="color-preview">
                <input type="color" id="widget_button_color" value="#4a86e8">
                <input type="text" id="widget_button_color_text" value="#4a86e8">
              </div>
            </div>

            <div class="form-group">
              <label for="assistant_chat_bubble_color">Assistant Bubble Color</label>
              <div class="color-preview">
                <input type="color" id="assistant_chat_bubble_color" value="#f0f0f0">
                <input type="text" id="assistant_chat_bubble_color_text" value="#f0f0f0">
              </div>
            </div>

            <div class="form-group">
              <label for="assistant_chat_font_color">Assistant Font Color</label>
              <div class="color-preview">
                <input type="color" id="assistant_chat_font_color" value="#333333">
                <input type="text" id="assistant_chat_font_color_text" value="#333333">
              </div>
            </div>

            <div class="form-group">
              <label for="profile_chat_bubble_color">User Bubble Color</label>
              <div class="color-preview">
                <input type="color" id="profile_chat_bubble_color" value="#4a86e8">
                <input type="text" id="profile_chat_bubble_color_text" value="#4a86e8">
              </div>
            </div>

            <div class="form-group">
              <label for="profile_chat_font_color">User Font Color</label>
              <div class="color-preview">
                <input type="color" id="profile_chat_font_color" value="#ffffff">
                <input type="text" id="profile_chat_font_color_text" value="#ffffff">
              </div>
            </div>
          </div>

          <!-- Avatars Tab -->
          <div class="tab-content" data-tab="avatars">
            <div class="form-group">
              <label for="assistant_avatar_url">Assistant Avatar URL</label>
              <input type="url" id="assistant_avatar_url" value="https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/park-ranger.png">
              <small>Image shown for assistant messages</small>
            </div>

            <div class="form-group">
              <label for="user_avatar_url">User Avatar URL</label>
              <input type="url" id="user_avatar_url" value="https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png">
              <small>Image shown for user messages</small>
            </div>

            <div class="form-group">
              <label for="profile_icon_url">Chat Button Icon URL</label>
              <input type="url" id="profile_icon_url" value="https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png">
              <small>Image shown on the chat button</small>
            </div>
          </div>

          <!-- Features Tab -->
          <div class="tab-content" data-tab="features">
            <h3 style="margin-bottom: 15px; color: #333;">Stable Features <span class="status-badge stable">Recommended</span></h3>
            <div class="features-grid">
              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_greeting_overlays" checked>
                  <label for="feature_greeting_overlays">Greeting Overlays</label>
                </div>
                <small>Show greeting bubbles when widget is closed</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_notification_badge" checked>
                  <label for="feature_notification_badge">Notification Badge</label>
                </div>
                <small>Show unread message count</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_expanded_mode" checked>
                  <label for="feature_expanded_mode">Expanded Mode</label>
                </div>
                <small>Allow full-height chat window</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_timestamps" checked>
                  <label for="feature_timestamps">Timestamps</label>
                </div>
                <small>Show relative time on messages</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_scroll_to_bottom_button" checked>
                  <label for="feature_scroll_to_bottom_button">Scroll Button</label>
                </div>
                <small>Show scroll-to-bottom button</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_tab_title_notifications" checked>
                  <label for="feature_tab_title_notifications">Tab Notifications</label>
                </div>
                <small>Flash tab title for new messages</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_new_message_divider" checked>
                  <label for="feature_new_message_divider">Message Divider</label>
                </div>
                <small>Show "New message" divider</small>
              </div>
            </div>

            <h3 style="margin: 25px 0 15px; color: #333;">Experimental Features <span class="status-badge experimental">Beta</span></h3>
            <div class="features-grid">
              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_sound_effects" disabled>
                  <label for="feature_sound_effects">Sound Effects</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_inactivity_nudge" disabled>
                  <label for="feature_inactivity_nudge">Inactivity Nudge</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_input_toolbar" disabled>
                  <label for="feature_input_toolbar">Input Toolbar</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_attachments" disabled>
                  <label for="feature_attachments">Attachments</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_emoji_picker" disabled>
                  <label for="feature_emoji_picker">Emoji Picker</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>

              <div class="feature-card">
                <div class="checkbox-group">
                  <input type="checkbox" id="feature_mic_input" disabled>
                  <label for="feature_mic_input">Voice Input</label>
                </div>
                <small>‚ö†Ô∏è Not implemented yet</small>
              </div>
            </div>
          </div>

          <!-- Privacy Tab -->
          <div class="tab-content" data-tab="privacy">
            <div class="checkbox-group">
              <input type="checkbox" id="privacy_enabled">
              <label for="privacy_enabled">Enable Privacy Policy Banner</label>
            </div>

            <div class="form-group">
              <label for="privacy_text_prefix">Text Prefix</label>
              <input type="text" id="privacy_text_prefix" value="By chatting, you agree to our">
            </div>

            <div class="form-group">
              <label for="privacy_link_text">Link Text</label>
              <input type="text" id="privacy_link_text" value="privacy policy">
            </div>

            <div class="form-group">
              <label for="privacy_text_suffix">Text Suffix</label>
              <input type="text" id="privacy_text_suffix" value=".">
            </div>

            <div class="form-group">
              <label for="privacy_content_type">Content Type</label>
              <select id="privacy_content_type">
                <option value="url">URL</option>
                <option value="markdown">Markdown</option>
              </select>
            </div>

            <div class="form-group">
              <label for="privacy_page_url">Privacy Policy URL</label>
              <input type="url" id="privacy_page_url" value="" placeholder="https://example.com/privacy">
            </div>

            <div class="form-group">
              <label for="privacy_markdown_content">Markdown Content</label>
              <textarea id="privacy_markdown_content" placeholder="Enter markdown content here..."></textarea>
              <small>Only used if content type is "markdown"</small>
            </div>

            <div class="form-group">
              <label for="privacy_popup_title">Popup Title</label>
              <input type="text" id="privacy_popup_title" value="Privacy Policy">
            </div>
          </div>

          <!-- Advanced Tab -->
          <div class="tab-content" data-tab="advanced">
            <div class="form-group">
              <label for="api_url">API URL</label>
              <input type="url" id="api_url" value="https://6jnsawhzi2.us-east-1.awsapprunner.com/api/v1/chats_openai">
              <small>Custom API endpoint (leave default if unsure)</small>
            </div>

            <div class="form-group">
              <label for="feedback_api_url">Feedback API URL</label>
              <input type="url" id="feedback_api_url" value="https://6jnsawhzi2.us-east-1.awsapprunner.com/v1/conversation/thumbup">
              <small>Endpoint for thumbs up/down feedback</small>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Apply Configuration</button>
          <button type="button" class="btn btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
        </form>
      </div>
    </div>

    <!-- Preview & Code Panel -->
    <div class="panel">
      <div class="panel-header">
        üëÅÔ∏è Preview & Embed Code
      </div>
      <div class="panel-content">
        <div class="preview-info">
          <h3>üì± Live Preview</h3>
          <p>The chat widget is running on this page with your current configuration. Click the chat button in the bottom-right corner to test it.</p>
        </div>

        <h3 style="margin-bottom: 10px; color: #333;">üìã Embed Code</h3>
        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Copy this code and paste it before the closing &lt;/body&gt; tag in your HTML:</p>
        
        <div class="code-container">
          <button class="copy-btn" onclick="copyEmbedCode()">Copy Code</button>
          <pre id="embedCode"></pre>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
          <strong style="color: #856404;">‚ö†Ô∏è Important:</strong>
          <p style="color: #856404; font-size: 13px; margin-top: 5px; line-height: 1.5;">
            Make sure to replace the script src with your actual widget bundle URL. The current path assumes the bundle is at <code>./dist/yodel-chat-widget-latest.js</code>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize settings BEFORE loading the widget
    // Load configuration from sessionStorage or use defaults
    const savedConfig = sessionStorage.getItem('yodelWidgetConfig');
    if (savedConfig) {
      window.yodelChatSettings = JSON.parse(savedConfig);
    } else {
      // Set default config
      window.yodelChatSettings = {
        shared_id: 'e6095c5e9d4311f09e25a9b8b1a79c0c',
        authentication_token: '',
        chat_title: 'Chat with Us',
        assistant_name: 'Assistant',
        assistant_subtitle: '',
        header_color: '#4a86e8',
        widget_button_color: '#4a86e8',
        show_avatar: true,
        assistant_chat_bubble_color: '#f0f0f0',
        assistant_chat_font_color: '#333333',
        assistant_avatar_url: 'https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/park-ranger.png',
        user_avatar_url: 'https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png',
        profile_icon_url: 'https://yodel-chat-widget.s3.us-east-1.amazonaws.com/assets/user.png',
        profile_chat_bubble_color: '#4a86e8',
        profile_chat_font_color: '#ffffff',
        agent: false,
        privacy_policy: {
          enabled: false,
          text_prefix: 'By chatting, you agree to our',
          link_text: 'privacy policy',
          text_suffix: '.',
          content_type: 'url',
          markdown_content: '',
          page_url: '',
          popup_title: 'Privacy Policy'
        },
        api_url: 'https://6jnsawhzi2.us-east-1.awsapprunner.com/api/v1/chats_openai',
        feedback_api_url: 'https://6jnsawhzi2.us-east-1.awsapprunner.com/v1/conversation/thumbup',
        features: {
          greeting_overlays: true,
          notification_badge: true,
          expanded_mode: true,
          timestamps: true,
          scroll_to_bottom_button: true,
          sound_effects: false,
          tab_title_notifications: true,
          inactivity_nudge: false,
          input_toolbar: false,
          attachments: false,
          emoji_picker: false,
          mic_input: false,
          new_message_divider: true
        }
      };
    }
  </script>

  <!-- Load the widget -->
  <script src="./dist/yodel-chat-widget-latest.js"></script>

  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
      });
    });

    // Color picker sync
    const colorInputs = ['header_color', 'widget_button_color', 'assistant_chat_bubble_color', 
                        'assistant_chat_font_color', 'profile_chat_bubble_color', 'profile_chat_font_color'];
    
    colorInputs.forEach(id => {
      const colorInput = document.getElementById(id);
      const textInput = document.getElementById(id + '_text');
      
      colorInput.addEventListener('input', (e) => {
        textInput.value = e.target.value;
      });
      
      textInput.addEventListener('input', (e) => {
        if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
          colorInput.value = e.target.value;
        }
      });
    });

    // Load configuration from sessionStorage or use defaults
    function loadConfiguration() {
      const savedConfig = sessionStorage.getItem('yodelWidgetConfig');
      if (savedConfig) {
        const config = JSON.parse(savedConfig);
        applyConfigToForm(config);
      }
    }

    // Apply configuration object to form
    function applyConfigToForm(config) {
      // Basic fields
      if (config.shared_id) document.getElementById('shared_id').value = config.shared_id;
      if (config.authentication_token) document.getElementById('authentication_token').value = config.authentication_token;
      if (config.chat_title) document.getElementById('chat_title').value = config.chat_title;
      if (config.assistant_name) document.getElementById('assistant_name').value = config.assistant_name;
      if (config.assistant_subtitle) document.getElementById('assistant_subtitle').value = config.assistant_subtitle;
      document.getElementById('show_avatar').checked = config.show_avatar !== false;
      document.getElementById('agent').checked = config.agent === true;

      // Colors
      if (config.header_color) {
        document.getElementById('header_color').value = config.header_color;
        document.getElementById('header_color_text').value = config.header_color;
      }
      if (config.widget_button_color) {
        document.getElementById('widget_button_color').value = config.widget_button_color;
        document.getElementById('widget_button_color_text').value = config.widget_button_color;
      }
      if (config.assistant_chat_bubble_color) {
        document.getElementById('assistant_chat_bubble_color').value = config.assistant_chat_bubble_color;
        document.getElementById('assistant_chat_bubble_color_text').value = config.assistant_chat_bubble_color;
      }
      if (config.assistant_chat_font_color) {
        document.getElementById('assistant_chat_font_color').value = config.assistant_chat_font_color;
        document.getElementById('assistant_chat_font_color_text').value = config.assistant_chat_font_color;
      }
      if (config.profile_chat_bubble_color) {
        document.getElementById('profile_chat_bubble_color').value = config.profile_chat_bubble_color;
        document.getElementById('profile_chat_bubble_color_text').value = config.profile_chat_bubble_color;
      }
      if (config.profile_chat_font_color) {
        document.getElementById('profile_chat_font_color').value = config.profile_chat_font_color;
        document.getElementById('profile_chat_font_color_text').value = config.profile_chat_font_color;
      }

      // Avatars
      if (config.assistant_avatar_url) document.getElementById('assistant_avatar_url').value = config.assistant_avatar_url;
      if (config.user_avatar_url) document.getElementById('user_avatar_url').value = config.user_avatar_url;
      if (config.profile_icon_url) document.getElementById('profile_icon_url').value = config.profile_icon_url;

      // Features
      if (config.features) {
        Object.keys(config.features).forEach(feature => {
          const checkbox = document.getElementById('feature_' + feature);
          if (checkbox) checkbox.checked = config.features[feature];
        });
      }

      // Privacy
      if (config.privacy_policy) {
        document.getElementById('privacy_enabled').checked = config.privacy_policy.enabled === true;
        if (config.privacy_policy.text_prefix) document.getElementById('privacy_text_prefix').value = config.privacy_policy.text_prefix;
        if (config.privacy_policy.link_text) document.getElementById('privacy_link_text').value = config.privacy_policy.link_text;
        if (config.privacy_policy.text_suffix) document.getElementById('privacy_text_suffix').value = config.privacy_policy.text_suffix;
        if (config.privacy_policy.content_type) document.getElementById('privacy_content_type').value = config.privacy_policy.content_type;
        if (config.privacy_policy.page_url) document.getElementById('privacy_page_url').value = config.privacy_policy.page_url;
        if (config.privacy_policy.markdown_content) document.getElementById('privacy_markdown_content').value = config.privacy_policy.markdown_content;
        if (config.privacy_policy.popup_title) document.getElementById('privacy_popup_title').value = config.privacy_policy.popup_title;
      }

      // Advanced
      if (config.api_url) document.getElementById('api_url').value = config.api_url;
      if (config.feedback_api_url) document.getElementById('feedback_api_url').value = config.feedback_api_url;
    }

    // Get configuration from form
    function getConfigFromForm() {
      return {
        shared_id: document.getElementById('shared_id').value,
        authentication_token: document.getElementById('authentication_token').value,
        chat_title: document.getElementById('chat_title').value,
        assistant_name: document.getElementById('assistant_name').value,
        assistant_subtitle: document.getElementById('assistant_subtitle').value,
        header_color: document.getElementById('header_color').value,
        widget_button_color: document.getElementById('widget_button_color').value,
        show_avatar: document.getElementById('show_avatar').checked,
        assistant_chat_bubble_color: document.getElementById('assistant_chat_bubble_color').value,
        assistant_chat_font_color: document.getElementById('assistant_chat_font_color').value,
        assistant_avatar_url: document.getElementById('assistant_avatar_url').value,
        user_avatar_url: document.getElementById('user_avatar_url').value,
        profile_icon_url: document.getElementById('profile_icon_url').value,
        profile_chat_bubble_color: document.getElementById('profile_chat_bubble_color').value,
        profile_chat_font_color: document.getElementById('profile_chat_font_color').value,
        agent: document.getElementById('agent').checked,
        privacy_policy: {
          enabled: document.getElementById('privacy_enabled').checked,
          text_prefix: document.getElementById('privacy_text_prefix').value,
          link_text: document.getElementById('privacy_link_text').value,
          text_suffix: document.getElementById('privacy_text_suffix').value,
          content_type: document.getElementById('privacy_content_type').value,
          markdown_content: document.getElementById('privacy_markdown_content').value,
          page_url: document.getElementById('privacy_page_url').value,
          popup_title: document.getElementById('privacy_popup_title').value
        },
        api_url: document.getElementById('api_url').value,
        feedback_api_url: document.getElementById('feedback_api_url').value,
        features: {
          greeting_overlays: document.getElementById('feature_greeting_overlays').checked,
          notification_badge: document.getElementById('feature_notification_badge').checked,
          expanded_mode: document.getElementById('feature_expanded_mode').checked,
          timestamps: document.getElementById('feature_timestamps').checked,
          scroll_to_bottom_button: document.getElementById('feature_scroll_to_bottom_button').checked,
          sound_effects: document.getElementById('feature_sound_effects').checked,
          tab_title_notifications: document.getElementById('feature_tab_title_notifications').checked,
          inactivity_nudge: document.getElementById('feature_inactivity_nudge').checked,
          input_toolbar: document.getElementById('feature_input_toolbar').checked,
          attachments: document.getElementById('feature_attachments').checked,
          emoji_picker: document.getElementById('feature_emoji_picker').checked,
          mic_input: document.getElementById('feature_mic_input').checked,
          new_message_divider: document.getElementById('feature_new_message_divider').checked
        }
      };
    }

    // Generate embed code
    function generateEmbedCode(config) {
      const configStr = JSON.stringify(config, null, 2)
        .split('\n')
        .map((line, i) => i === 0 ? line : '  ' + line)
        .join('\n');

      return '<!-- Yodel Chat Widget -->\n' +
        '<script>\n' +
        '  window.yodelChatSettings = ' + configStr + ';\n' +
        '<' + '/script>\n' +
        '<script src="./dist/yodel-chat-widget-latest.js"><' + '/script>';
    }

    // Update embed code display
    function updateEmbedCode() {
      const config = getConfigFromForm();
      const embedCode = generateEmbedCode(config);
      document.getElementById('embedCode').textContent = embedCode;
    }

    // Copy embed code to clipboard
    function copyEmbedCode() {
      const embedCode = document.getElementById('embedCode').textContent;
      navigator.clipboard.writeText(embedCode).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = '‚úì Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Copy Code';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    // Reset to defaults
    function resetToDefaults() {
      if (confirm('Are you sure you want to reset all settings to defaults?')) {
        sessionStorage.removeItem('yodelWidgetConfig');
        location.reload();
      }
    }

    // Form Update embed code displaysubmission
    document.getElementById('configForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const config = getConfigFromForm();
      
      // Save to sessionStorage
      sessionStorage.setItem('yodelWidgetConfig', JSON.stringify(config));
      
      // Update embed code
      updateEmbedCode();
      
      // Show success message
      alert('Configuration applied! The widget will reload with new settings.');
      
      // Reload page to reinitialize widget
      location.reload();
    });

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadConfiguration();
      updateEmbedCode();
    });
  </script>
</body>
</html>
